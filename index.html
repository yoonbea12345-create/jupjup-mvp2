<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¤ì¤(JUPJUP): ë‚˜ë§Œì˜ ê²°ì œ ë¹„ì„œ</title>
  <meta name="description" content="ê²°ì œ ì§ì „, ê°€ì¥ ìœ ë¦¬í•œ ê²°ì œìˆ˜ë‹¨ì„ ì¶”ì²œí•˜ëŠ” ì¤ì¤(JUPJUP)" />

  <!-- âœ… favicon: logo1 ì‚¬ìš© (ìºì‹œ ë¬´íš¨í™”ìš© v=ê°’ì€ í•„ìš” ì‹œ ìˆ«ìë§Œ ë³€ê²½) -->
  <link rel="icon" href="/logo1.png?v=1" type="image/png" />
  <link rel="apple-touch-icon" href="/logo1.png?v=1" />

  <style>
    :root {
      --bg: #f8f9fc;
      --card: #ffffff;
      --text: #101828;
      --muted: #475467;
      --line: #eaecf0;

      /* ë¸Œëœë“œ ì»¬ëŸ¬ */
      --brand: #FF6B00;
      --brand-weak: #fff1e6;
      --brand-dark: #E66000;

      --shadow: 0 12px 16px -4px rgba(16, 24, 40, 0.08);
      --radius: 20px;

      --ok: #027a48;
      --ok-bg: #ecfdf3;
      --warn: #b44d12;
      --warn-bg: #fffaeb;
      --bad: #b42318;
      --bad-bg: #fef3f2;

      /* ìŠ¤í”Œë˜ì‹œ ë°°ê²½(ê³¼í•œ ë‹¨ìƒ‰ ë°©ì§€) */
      --splash-top: #FF7A1A;
      --splash-bottom: #FFB46A;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* ===== Splash ===== */
    .splash {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(900px 520px at 50% 28%, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, var(--splash-top) 0%, var(--splash-bottom) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 400ms ease;
    }
    .splash.fade-out { opacity: 0; pointer-events: none; }

    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      text-align: center;
      padding: 24px 18px;
    }
    .splash img {
      width: 150px;
      height: 150px;
      object-fit: contain;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.14));
    }
    .splash-title {
      font-weight: 900;
      font-size: 22px;
      color: rgba(255,255,255,0.98);
      letter-spacing: -0.04em;
      line-height: 1.05;
      text-shadow: 0 10px 20px rgba(0,0,0,0.08);
    }
    .splash-subtitle {
      font-weight: 800;
      font-size: 14px;
      color: rgba(255,255,255,0.92);
      letter-spacing: -0.02em;
    }

    /* ===== Header ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--line);
    }
    .header-inner {
      max-width: 600px;
      margin: 0 auto;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 28px;
    }
    /* âœ… í—¤ë” ë¡œê³ ëŠ” logo3ë§Œ ì‚¬ìš© + í‘œì‹œ/í¬ê¸° ê°•ì œ */
    .brand img {
      width: 28px !important;
      height: 28px !important;
      display: block !important;
      object-fit: contain !important;
    }
    .brand .name {
      font-weight: 800;
      font-size: 18px;
      color: var(--brand);
      letter-spacing: -0.02em;
      white-space: nowrap;
    }
    .logo-fail {
      display: none;
      font-size: 11px;
      font-weight: 800;
      color: var(--bad);
      background: var(--bad-bg);
      border: 1px solid rgba(180, 35, 24, 0.25);
      padding: 6px 10px;
      border-radius: 999px;
      white-space: nowrap;
    }

    main {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px 16px;
    }
    .stack { display: flex; flex-direction: column; gap: 16px; }

    /* ===== UI Elements ===== */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      background: white;
      border: 1px solid var(--line);
      font-size: 14px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
      max-width: 100%;
    }
    .pill .dot { width: 8px; height: 8px; background: var(--brand); border-radius: 50%; }
    .pill strong { white-space: nowrap; }
    .pill span {
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .notice {
      background: var(--brand-weak);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--brand-dark);
      font-size: 13px;
      font-weight: 800;
      border: 1px solid rgba(255, 107, 0, 0.15);
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .panel h2 {
      margin: 0 0 16px;
      font-size: 15px;
      font-weight: 900;
      color: var(--muted);
      letter-spacing: -0.01em;
    }

    .form-grid { display: flex; flex-direction: column; gap: 16px; }
    label {
      display: block;
      font-size: 13px;
      font-weight: 800;
      color: var(--muted);
      margin-bottom: 6px;
    }
    select, input {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fff;
      font-size: 15px;
      outline: none;
      transition: all 0.2s;
    }
    select:focus, input:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--brand-weak); }

    .btn {
      width: 100%;
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-weight: 900;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn.primary { background: var(--brand); color: white; margin-top: 8px; }
    .btn.primary:active { background: var(--brand-dark); transform: scale(0.98); }
    .btn.ghost { background: transparent; color: var(--muted); padding: 10px 8px; font-size: 14px; font-weight: 900; }

    /* ===== Result Cards ===== */
    .rec-card {
      position: relative;
      border-radius: var(--radius);
      background: white;
      border: 1px solid var(--line);
      padding: 20px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .rec-card.top {
      border: 2px solid var(--brand);
      background: linear-gradient(180deg, #fff 0%, #fff9f5 100%);
      box-shadow: 0 10px 20px rgba(255,107,0,0.10);
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 900;
      margin-bottom: 12px;
    }
    .badge.ok { background: var(--ok-bg); color: var(--ok); }
    .badge.warn { background: var(--warn-bg); color: var(--warn); }
    .badge.bad { background: var(--bad-bg); color: var(--bad); }

    .rec-title { font-size: 18px; font-weight: 900; margin-bottom: 6px; letter-spacing: -0.02em; }
    .rec-meta { font-size: 13px; color: var(--muted); margin-bottom: 14px; font-weight: 800; }

    .benefit-highlight {
      background: var(--brand-weak);
      color: var(--brand-dark);
      padding: 12px 12px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255, 107, 0, 0.18);
    }

    .wm {
      position: absolute;
      right: 16px;
      bottom: 14px;
      width: 70px;
      opacity: 0.06;
      pointer-events: none;
      user-select: none;
      transform: rotate(-8deg);
    }

    .footnote {
      font-size: 12px;
      color: #98a2b3;
      margin-top: 12px;
      text-align: center;
      font-weight: 800;
      line-height: 1.5;
    }

    .muted-center {
      text-align: center;
      padding: 40px 0;
      color: #98a2b3;
      font-size: 14px;
      font-weight: 900;
    }
  </style>
</head>

<body>
  <!-- Splash -->
  <div class="splash" id="splash" aria-hidden="true">
    <div class="splash-content">
      <img src="/logo1.png" alt="ì¤ì¤ ìŠ¤í”Œë˜ì‹œ ë¡œê³ " />
      <div class="splash-title">ì¤ì¤:</div>
      <div class="splash-subtitle">ë‚˜ë§Œì˜ ê²°ì œ ë¹„ì„œ</div>
    </div>
  </div>

  <header>
    <div class="header-inner">
      <div class="brand" aria-label="ì¤ì¤ í—¤ë”">
        <!-- âœ… í—¤ë” ë¡œê³ ëŠ” logo3ë§Œ ì‚¬ìš© + ìºì‹œ ë¬´íš¨í™” -->
        <img id="headerLogo" src="/logo3.png?v=20260123" alt="ì¤ì¤ ë¡œê³ " />
        <div class="name">ì¤ì¤: ë‚˜ë§Œì˜ ê²°ì œ ë¹„ì„œ</div>
      </div>

      <span id="logoFail" class="logo-fail">logo3 ë¡œë“œ ì‹¤íŒ¨</span>

      <div style="font-size:12px; color:var(--muted); font-weight:900; white-space:nowrap;">
    </div>
  </header>

  <main>
    <div class="stack">
      <!-- store íŒŒë¼ë¯¸í„° ìˆì„ ë•Œë§Œ í‘œì‹œ -->
      <div id="storeWrap" style="display:none;">
        <div class="pill" title="ë§¤ì¥ëª…">
          <span class="dot" aria-hidden="true"></span>
          <strong id="storeName">-</strong>
          <span>ì—ì„œ ê²°ì œ ì¤‘</span>
        </div>
      </div>

      <!-- category íŒŒë¼ë¯¸í„°ê°€ ìˆì„ ë•Œ ì•ˆë‚´ -->
      <div id="qrNotice" class="notice" style="display:none;">
        ì—…ì¢…ì´ ìë™ì„ íƒ ëìŠµë‹ˆë‹¤. í‹€ë¦° ê²½ìš° ì•„ë˜ì—ì„œ ìˆ˜ì • í•´ì£¼ì„¸ìš”.
      </div>

      <section class="panel" aria-label="ê²°ì œ ì •ë³´ ì…ë ¥">
        <h2>ì–´ë””ì„œ ê²°ì œí•˜ì‹œë‚˜ìš”?</h2>

        <div class="form-grid">
          <div>
            <label for="categorySelect">ì—…ì¢… ì„ íƒ</label>
            <select id="categorySelect">
              <option value="">ì—…ì¢… ì„ íƒ</option>
              <option value="ì¹´í˜">ì¹´í˜/ë””ì €íŠ¸</option>
              <option value="ìŒì‹ì ">ìŒì‹ì /ì‹ë‹¹</option>
              <option value="í¸ì˜ì ">í¸ì˜ì /ë§ˆíŠ¸</option>
              <option value="ëŒ€ì¤‘êµí†µ">ëŒ€ì¤‘êµí†µ</option>
              <option value="ì˜¨ë¼ì¸">ì˜¨ë¼ì¸ ì‡¼í•‘</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
          </div>

          <div>
            <label for="amountInput">ê²°ì œ ê¸ˆì•¡ (ì˜ˆìƒ)</label>
            <input id="amountInput" type="text" inputmode="numeric" placeholder="ì˜ˆ: 5400" />
          </div>
        </div>

        <button class="btn primary" id="btnRecommend">í˜œíƒ ë¹„êµí•˜ê¸°</button>
        <button class="btn ghost" id="btnReset">ë‹¤ì‹œ ì„ íƒí•˜ê¸°</button>
      </section>

      <section class="panel" aria-label="ì¶”ì²œ ê²°ê³¼">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:10px;">
          <h2 style="margin:0;">ì¶”ì²œ ì¹´ë“œ ë­í‚¹</h2>
          <span id="resultSub" style="font-size:12px; color:var(--brand); font-weight:900; white-space:nowrap;"></span>
        </div>

        <div id="results">
          <div class="muted-center">ì—…ì¢…ì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸.</div>
        </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    /*********************
     * Splash: 0.8~1ì´ˆ í›„ í˜ì´ë“œì•„ì›ƒ
     *********************/
    window.addEventListener('load', () => {
      setTimeout(() => {
        const s = document.getElementById('splash');
        s.classList.add('fade-out');
        setTimeout(() => s.style.display = 'none', 420);
      }, 900);
    });

    /*********************
     * í—¤ë” ë¡œê³  ë¡œë“œ ì‹¤íŒ¨ ê°ì§€(ì›ì¸ í™•ì¸ìš©)
     *********************/
    (function headerLogoCheck(){
      const img = document.getElementById('headerLogo');
      const fail = document.getElementById('logoFail');

      img.addEventListener('error', () => {
        fail.style.display = 'inline-flex';
        console.log('[JUPJUP] logo3 load failed:', img.currentSrc || img.src);
      });

      img.addEventListener('load', () => {
        fail.style.display = 'none';
      });
    })();

    /*********************
     * URL Params
     * category=ì¹´í˜|ìŒì‹ì |í¸ì˜ì |ëŒ€ì¤‘êµí†µ|ì˜¨ë¼ì¸|ê¸°íƒ€
     * from=qr
     * store=ìŠ¤íƒ€ë²…ìŠ¤
     *********************/
    const params = new URLSearchParams(window.location.search);

    function safeDecode(value){
      try { return decodeURIComponent(value || ''); } catch(e){ return value || ''; }
    }

    function normalizeCategory(v){
      const s = (v || '').trim();
      const allowed = ["ì¹´í˜","ìŒì‹ì ","í¸ì˜ì ","ëŒ€ì¤‘êµí†µ","ì˜¨ë¼ì¸","ê¸°íƒ€"];
      if (allowed.includes(s)) return s;
      const map = { "ì¹´í˜/ë””ì €íŠ¸":"ì¹´í˜", "ì‹ë‹¹":"ìŒì‹ì ", "ë ˆìŠ¤í† ë‘":"ìŒì‹ì " };
      return map[s] || "";
    }

    function digitsOnly(v){
      return String(v || '').replace(/[^0-9]/g, '');
    }

    function formatKRW(v){
      const n = Number(digitsOnly(v));
      if (!Number.isFinite(n) || n <= 0) return '';
      return n.toLocaleString('ko-KR') + 'ì›';
    }

    const pFrom = (params.get('from') || '').trim().toLowerCase();
    const pStore = safeDecode(params.get('store') || '').trim();
    const pCategory = normalizeCategory(safeDecode(params.get('category') || '').trim());

    const categorySelect = document.getElementById('categorySelect');
    const amountInput = document.getElementById('amountInput');
    const resultsEl = document.getElementById('results');
    const resultSub = document.getElementById('resultSub');

    const storeWrap = document.getElementById('storeWrap');
    const storeName = document.getElementById('storeName');
    const qrNotice = document.getElementById('qrNotice');

    if (pStore) {
      storeName.textContent = pStore;
      storeWrap.style.display = 'block';
    }

    if (pCategory) {
      categorySelect.value = pCategory;
      qrNotice.style.display = 'block';
    } else {
      qrNotice.style.display = 'none';
    }

    amountInput.addEventListener('input', () => {
      amountInput.value = digitsOnly(amountInput.value);
    });

    /*********************
     * ë”ë¯¸ ì¹´ë“œ(ë­í‚¹/ì ìˆ˜/ì‹¤ì /ì—…ì¢… ë§¤ì¹­ ê¸°ë°˜)  â† âœ… ì—¬ê¸° â€œë¡¤ë°± ì™„ë£Œâ€
     *********************/
    const dummyCards = [
      {
        issuer: "ì‹ í•œ",
        name: "ì‹ í•œ Deep Dream(ë”ë¯¸)",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 420000 },
        rules: [
          { category:["ì¹´í˜"], benefit:"ì¹´í˜ 10% ì ë¦½ (ì›” 5ì²œì›)" },
          { category:["ìŒì‹ì "], benefit:"ìŒì‹ì  5% ì ë¦½ (ì›” 7ì²œì›)" },
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  2% ì ë¦½ (ì›” 3ì²œì›)" }
        ],
        fallback: "ê¸°ë³¸ í˜œíƒ ì—†ìŒ(ë”ë¯¸)"
      },
      {
        issuer: "êµ­ë¯¼",
        name: "KB í•´í”¼í¬ì¸íŠ¸(ë”ë¯¸)",
        requirements: { monthlySpendMin: 400000 },
        user: { monthlySpent: 260000 }, // ë¯¸ì¶©ì¡±
        rules: [
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  8% í• ì¸ (ì›” 4ì²œì›)" },
          { category:["ì¹´í˜"], benefit:"ì¹´í˜ 7% í• ì¸ (ì›” 6ì²œì›)" }
        ],
        fallback: "ê¸°ë³¸ í˜œíƒ ì—†ìŒ(ë”ë¯¸)"
      },
      {
        issuer: "í˜„ëŒ€",
        name: "í˜„ëŒ€ ZERO(ë”ë¯¸)",
        requirements: { monthlySpendMin: 0 },
        user: { monthlySpent: 0 },
        rules: [
          { category:["ì˜¨ë¼ì¸"], benefit:"ì˜¨ë¼ì¸ 2% í• ì¸ (ì›” 8ì²œì›)" },
          { category:["ê¸°íƒ€"], benefit:"ì „ê°€ë§¹ì  1% í• ì¸(ê°€ì •)" }
        ],
        fallback: "ì „ê°€ë§¹ì  1% í• ì¸(ê°€ì •)"
      }
    ];

    function inferIssuerAffinity(store){
      const s = (store || "").toLowerCase();
      if (s.includes("ìŠ¤íƒ€ë²…ìŠ¤") || s.includes("starbucks")) return "ì‹ í•œ";
      if (s.includes("gs") || s.includes("gs25")) return "êµ­ë¯¼";
      if (s.includes("cu")) return "í˜„ëŒ€";
      return "";
    }

    function findRule(card, category){
      return card.rules.find(r => (r.category || []).includes(category)) || null;
    }

    function computeScore(card, category, store){
      let score = 0;

      // ì—…ì¢… í˜œíƒ ì¼ì¹˜
      const rule = findRule(card, category);
      score += rule ? 55 : 15;

      // ì‹¤ì  ì¶©ì¡±
      const req = Number(card.requirements?.monthlySpendMin || 0);
      const spent = Number(card.user?.monthlySpent || 0);
      const met = (req === 0) ? true : (spent >= req);
      score += met ? 25 : -10;

      // ì¹´ë“œì‚¬ ì¶”ì • ì¼ì¹˜(ë”ë¯¸ ê°€ì¤‘ì¹˜)
      const affinity = inferIssuerAffinity(store);
      if (affinity && affinity === card.issuer) score += 12;

      score = Math.max(0, Math.min(100, score));
      return { score, met, rule, req, spent };
    }

    function badgeByScore(score){
      if (score >= 80) return { cls:"ok", label:"ìµœì  í˜œíƒ" };
      if (score >= 60) return { cls:"warn", label:"ì¶”ì²œ" };
      return { cls:"bad", label:"ë¹„ì¶”ì²œ" };
    }

    function renderResults(){
      const cat = categorySelect.value;
      if (!cat) {
        resultsEl.innerHTML = '<div class="muted-center">ì—…ì¢…ì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì‹­ì‹œì˜¤.</div>';
        resultSub.textContent = "";
        return;
      }

      const amountText = formatKRW(amountInput.value);
      const ctx = [cat];
      if (pFrom === "qr" || pCategory) ctx.push("QR ì§„ì…");
      if (amountText) ctx.push(amountText);
      resultSub.textContent = ctx.join(" Â· ");

      const ranked = dummyCards
        .map(card => ({ card, ...computeScore(card, cat, pStore || "") }))
        .sort((a,b) => b.score - a.score);

      resultsEl.innerHTML = "";

      ranked.forEach((item, idx) => {
        const { card, score, met, rule, req, spent } = item;
        const badge = badgeByScore(score);

        const perfText = (req === 0)
          ? "ì „ì›”ì‹¤ì  ì¡°ê±´ ì—†ìŒ"
          : (met
              ? `ì „ì›”ì‹¤ì  ${req.toLocaleString('ko-KR')}ì› ì¶©ì¡±`
              : `ì „ì›”ì‹¤ì  ë¯¸ì¶©ì¡± (${Math.max(0, req - spent).toLocaleString('ko-KR')}ì› ë¶€ì¡±)`);

        const benefitText = rule?.benefit || card.fallback;

        const div = document.createElement('div');
        div.className = `rec-card ${idx === 0 ? "top" : ""}`;
        div.innerHTML = `
          <div class="badge ${badge.cls}">${idx+1}ìˆœìœ„ Â· ${badge.label} (${score}ì )</div>
          <div class="rec-title">${card.name}</div>
          <div class="rec-meta">${card.issuer} Â· ${perfText}</div>
          <div class="benefit-highlight">ğŸ’° ${benefitText}</div>
          <img src="/logo3.png?v=20260123" class="wm" alt="" aria-hidden="true" />
        `;
        resultsEl.appendChild(div);
      });
    }

    document.getElementById('btnRecommend').addEventListener('click', renderResults);

    document.getElementById('btnReset').addEventListener('click', () => {
      categorySelect.value = pCategory || "";
      amountInput.value = "";
      if (pCategory) renderResults();
      else {
        resultsEl.innerHTML = '<div class="muted-center">ì—…ì¢…ì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì‹­ì‹œì˜¤.</div>';
        resultSub.textContent = "";
      }
    });

    // QR(category ì¡´ì¬)ë©´ ìë™ ë Œë”
    if (pCategory) renderResults();
  </script>
</body>
</html>


