<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>줍줍(JUPJUP) - 나만의 결제 비서</title>
  <meta name="description" content="결제 직전, 가장 유리한 결제수단을 추천하는 줍줍(JUPJUP)" />

  <style>
    :root {
      --bg: #f8f9fc;
      --card: #ffffff;
      --text: #101828;
      --muted: #475467;
      --line: #eaecf0;

      /* 브랜드 컬러: 도파민 오렌지 조합 */
      --brand: #FF6B00;
      --brand-weak: #fff1e6;
      --brand-dark: #E66000;

      --shadow: 0 12px 16px -4px rgba(16, 24, 40, 0.08);
      --radius: 20px;

      --ok: #027a48;
      --ok-bg: #ecfdf3;
      --warn: #b44d12;
      --warn-bg: #fffaeb;
      --bad: #b42318;
      --bad-bg: #fef3f2;

      /* 스플래시 배경(과한 단색 방지: 그라데이션 + 하이라이트) */
      --splash-top: #FF7A1A;
      --splash-bottom: #FFB46A;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* ===== Splash ===== */
    .splash {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(900px 520px at 50% 28%, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, var(--splash-top) 0%, var(--splash-bottom) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 400ms ease;
    }
    .splash.fade-out { opacity: 0; pointer-events: none; }

    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      text-align: center;
      padding: 24px 18px;
    }

    .splash img {
      width: 150px;
      height: 150px;
      object-fit: contain;
      /* logo1 자체에 배경이 포함된 이미지여도 경계가 덜 도드라지게 그림자를 부드럽게 */
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.14));
    }

    .splash-title {
      font-weight: 900;
      font-size: 22px;
      color: rgba(255,255,255,0.98);
      letter-spacing: -0.04em;
      line-height: 1.05;
      text-shadow: 0 10px 20px rgba(0,0,0,0.08);
    }
    .splash-subtitle {
      font-weight: 700;
      font-size: 14px;
      color: rgba(255,255,255,0.92);
      letter-spacing: -0.02em;
    }

    /* ===== Header ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--line);
    }
    .header-inner {
      max-width: 600px;
      margin: 0 auto;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 28px;
    }
    /* 헤더 로고(logo3) 안 보이는 케이스 방지: 표시/크기 강제 */
    .brand img {
      width: 28px !important;
      height: 28px !important;
      display: block !important;
      object-fit: contain !important;
    }
    .brand .name {
      font-weight: 800;
      font-size: 18px;
      color: var(--brand);
      letter-spacing: -0.02em;
      white-space: nowrap;
    }

    /* 로고 로드 실패 표시(원인 확인용) */
    .logo-fail {
      display: none;
      font-size: 11px;
      font-weight: 700;
      color: var(--bad);
      background: var(--bad-bg);
      border: 1px solid rgba(180, 35, 24, 0.25);
      padding: 6px 10px;
      border-radius: 999px;
      white-space: nowrap;
    }

    main {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px 16px;
    }
    .stack { display: flex; flex-direction: column; gap: 16px; }

    /* ===== UI Elements ===== */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      background: white;
      border: 1px solid var(--line);
      font-size: 14px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
      max-width: 100%;
    }
    .pill .dot { width: 8px; height: 8px; background: var(--brand); border-radius: 50%; }
    .pill strong { white-space: nowrap; }
    .pill span {
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .notice {
      background: var(--brand-weak);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--brand-dark);
      font-size: 13px;
      font-weight: 700;
      border: 1px solid rgba(255, 107, 0, 0.15);
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .panel h2 {
      margin: 0 0 16px;
      font-size: 15px;
      font-weight: 800;
      color: var(--muted);
      letter-spacing: -0.01em;
    }

    .form-grid { display: flex; flex-direction: column; gap: 16px; }
    label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      color: var(--muted);
      margin-bottom: 6px;
    }
    select, input {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fff;
      font-size: 15px;
      outline: none;
      transition: all 0.2s;
    }
    select:focus, input:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 4px var(--brand-weak);
    }

    .btn {
      width: 100%;
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-weight: 800;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn.primary { background: var(--brand); color: white; margin-top: 8px; }
    .btn.primary:active { background: var(--brand-dark); transform: scale(0.98); }
    .btn.ghost {
      background: transparent;
      color: var(--muted);
      padding: 10px 8px;
      font-size: 14px;
      font-weight: 800;
    }

    /* ===== Result Cards ===== */
    .rec-card {
      position: relative;
      border-radius: var(--radius);
      background: white;
      border: 1px solid var(--line);
      padding: 20px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .rec-card.top {
      border: 2px solid var(--brand);
      background: linear-gradient(180deg, #fff 0%, #fff9f5 100%);
      box-shadow: 0 10px 20px rgba(255,107,0,0.10);
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 900;
      margin-bottom: 12px;
    }
    .badge.ok { background: var(--ok-bg); color: var(--ok); }
    .badge.warn { background: var(--warn-bg); color: var(--warn); }
    .badge.bad { background: var(--bad-bg); color: var(--bad); }

    .rec-title { font-size: 18px; font-weight: 900; margin-bottom: 6px; letter-spacing: -0.02em; }
    .rec-meta { font-size: 13px; color: var(--muted); margin-bottom: 14px; font-weight: 700; }

    .benefit-highlight {
      background: var(--brand-weak);
      color: var(--brand-dark);
      padding: 12px 12px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255, 107, 0, 0.18);
    }

    .wm {
      position: absolute;
      right: 16px;
      bottom: 14px;
      width: 70px;
      opacity: 0.06;
      pointer-events: none;
      user-select: none;
      transform: rotate(-8deg);
    }

    .footnote {
      font-size: 12px;
      color: #98a2b3;
      margin-top: 12px;
      text-align: center;
      font-weight: 700;
      line-height: 1.5;
    }

    /* 보조 텍스트 */
    .muted-center {
      text-align: center;
      padding: 40px 0;
      color: #98a2b3;
      font-size: 14px;
      font-weight: 800;
    }
  </style>
</head>

<body>
  <!-- Splash -->
  <div class="splash" id="splash" aria-hidden="true">
    <div class="splash-content">
      <img src="logo1.png" alt="줍줍 스플래시 로고" />
      <div class="splash-title">줍줍</div>
      <div class="splash-subtitle">나만의 결제 비서</div>
    </div>
  </div>

  <header>
    <div class="header-inner">
      <div class="brand" aria-label="줍줍 헤더">
        <!-- 헤더 로고는 logo3만 사용 + 캐시 무효화 -->
        <img id="headerLogo" src="./logo3.png?v=20260122" alt="줍줍 로고" />
        <div class="name">JUPJUP</div>
      </div>

      <span id="logoFail" class="logo-fail">logo3 로드 실패</span>

      <div style="font-size:12px; color:var(--muted); font-weight:800; white-space:nowrap;">
        스마트 결제 비서
      </div>
    </div>
  </header>

  <main>
    <div class="stack">
      <!-- store 파라미터 있을 때만 표시 -->
      <div id="storeWrap" style="display:none;">
        <div class="pill" title="매장명">
          <span class="dot" aria-hidden="true"></span>
          <strong id="storeName">-</strong>
          <span>에서 결제 중</span>
        </div>
      </div>

      <!-- category 파라미터가 있을 때 안내 -->
      <div id="qrNotice" class="notice" style="display:none;">
        QR로 업종을 자동 선택했습니다. 필요하면 아래에서 직접 변경하실 수 있습니다.
      </div>

      <section class="panel" aria-label="결제 정보 입력">
        <h2>어디서 결제하시나요?</h2>

        <div class="form-grid">
          <div>
            <label for="categorySelect">업종 선택</label>
            <select id="categorySelect">
              <option value="">업종 선택</option>
              <option value="카페">카페/디저트</option>
              <option value="음식점">음식점/식당</option>
              <option value="편의점">편의점/마트</option>
              <option value="대중교통">대중교통</option>
              <option value="온라인">온라인 쇼핑</option>
              <option value="기타">기타</option>
            </select>
          </div>

          <div>
            <label for="amountInput">결제 금액 (예상)</label>
            <!-- type=number는 기기/브라우저마다 입력 깨짐이 있어 text + 숫자필터로 안정화 -->
            <input id="amountInput" type="text" inputmode="numeric" placeholder="예: 5400" />
          </div>
        </div>

        <button class="btn primary" id="btnRecommend">혜택 비교하기</button>
        <button class="btn ghost" id="btnReset">다시 선택하기</button>
      </section>

      <section class="panel" aria-label="추천 결과">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:10px;">
          <h2 style="margin:0;">추천 카드 랭킹</h2>
          <span id="resultSub" style="font-size:12px; color:var(--brand); font-weight:900; white-space:nowrap;"></span>
        </div>

        <div id="results">
          <div class="muted-center">업종을 선택하고 버튼을 눌러주십시오.</div>
        </div>

        <div class="footnote">
          본 데이터는 MVP 테스트용 더미 데이터입니다.<br/>
          실제 연동 시 실시간 혜택/한도/실적 정보가 반영됩니다.
        </div>
      </section>
    </div>
  </main>

  <script>
    /*********************
     * Splash: 0.8~1초 후 페이드아웃
     *********************/
    window.addEventListener('load', () => {
      setTimeout(() => {
        const s = document.getElementById('splash');
        s.classList.add('fade-out');
        setTimeout(() => s.style.display = 'none', 420);
      }, 900);
    });

    /*********************
     * 헤더 로고 로드 실패 감지(원인 확인용)
     *********************/
    (function headerLogoCheck(){
      const img = document.getElementById('headerLogo');
      const fail = document.getElementById('logoFail');

      img.addEventListener('error', () => {
        fail.style.display = 'inline-flex';
        console.log('[JUPJUP] logo3 load failed:', img.currentSrc || img.src);
      });

      img.addEventListener('load', () => {
        fail.style.display = 'none';
      });
    })();

    /*********************
     * URL Params
     * category=카페|음식점|편의점|대중교통|온라인|기타
     * from=qr
     * store=스타벅스
     *********************/
    const params = new URLSearchParams(window.location.search);

    function safeDecode(value){
      try { return decodeURIComponent(value || ''); } catch(e){ return value || ''; }
    }

    function normalizeCategory(v){
      const s = (v || '').trim();
      const allowed = ["카페","음식점","편의점","대중교통","온라인","기타"];
      if (allowed.includes(s)) return s;
      const map = { "카페/디저트":"카페", "식당":"음식점", "레스토랑":"음식점" };
      return map[s] || "";
    }

    function digitsOnly(v){
      return String(v || '').replace(/[^0-9]/g, '');
    }

    function formatKRW(v){
      const n = Number(digitsOnly(v));
      if (!Number.isFinite(n) || n <= 0) return '';
      return n.toLocaleString('ko-KR') + '원';
    }

    const pFrom = (params.get('from') || '').trim().toLowerCase();
    const pStore = safeDecode(params.get('store') || '').trim();
    const pCategory = normalizeCategory(safeDecode(params.get('category') || '').trim());

    const categorySelect = document.getElementById('categorySelect');
    const amountInput = document.getElementById('amountInput');
    const resultsEl = document.getElementById('results');
    const resultSub = document.getElementById('resultSub');

    const storeWrap = document.getElementById('storeWrap');
    const storeName = document.getElementById('storeName');
    const qrNotice = document.getElementById('qrNotice');

    if (pStore) {
      storeName.textContent = pStore;
      storeWrap.style.display = 'block';
    }

    if (pCategory) {
      categorySelect.value = pCategory;
      qrNotice.style.display = 'block';
    } else {
      qrNotice.style.display = 'none';
    }

    // 금액 입력 안정화(붙여넣기/한글 등 들어와도 숫자만 유지)
    amountInput.addEventListener('input', () => {
      const d = digitsOnly(amountInput.value);
      amountInput.value = d;
    });

    /*********************
     * 더미 카드(구조화): 업종 매칭 + 실적 충족 여부 반영
     *********************/
    const dummyCards = [
      {
        issuer: "신한",
        name: "신한 Deep Dream(더미)",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 420000 },
        rules: [
          { category:["카페"], benefit:"카페 10% 적립 (월 5천원)" },
          { category:["음식점"], benefit:"음식점 5% 적립 (월 7천원)" },
          { category:["편의점"], benefit:"편의점 2% 적립 (월 3천원)" }
        ],
        fallback: "기본 혜택 없음(더미)"
      },
      {
        issuer: "국민",
        name: "KB 해피포인트(더미)",
        requirements: { monthlySpendMin: 400000 },
        user: { monthlySpent: 260000 }, // 미충족
        rules: [
          { category:["편의점"], benefit:"편의점 8% 할인 (월 4천원)" },
          { category:["카페"], benefit:"카페 7% 할인 (월 6천원)" }
        ],
        fallback: "기본 혜택 없음(더미)"
      },
      {
        issuer: "현대",
        name: "현대 ZERO(더미)",
        requirements: { monthlySpendMin: 0 },
        user: { monthlySpent: 0 },
        rules: [
          { category:["온라인"], benefit:"온라인 2% 할인 (월 8천원)" },
          { category:["기타"], benefit:"전가맹점 1% 할인(가정)" }
        ],
        fallback: "전가맹점 1% 할인(가정)"
      }
    ];

    function inferIssuerAffinity(store){
      const s = (store || "").toLowerCase();
      if (s.includes("스타벅스") || s.includes("starbucks")) return "신한";
      if (s.includes("gs") || s.includes("gs25")) return "국민";
      if (s.includes("cu")) return "현대";
      return "";
    }

    function findRule(card, category){
      return card.rules.find(r => (r.category || []).includes(category)) || null;
    }

    function computeScore(card, category, store){
      let score = 0;

      // 업종 혜택 일치
      const rule = findRule(card, category);
      score += rule ? 55 : 15;

      // 실적 충족
      const req = Number(card.requirements?.monthlySpendMin || 0);
      const spent = Number(card.user?.monthlySpent || 0);
      const met = (req === 0) ? true : (spent >= req);
      score += met ? 25 : -10;

      // 카드사 추정 일치(더미 가중치)
      const affinity = inferIssuerAffinity(store);
      if (affinity && affinity === card.issuer) score += 12;

      score = Math.max(0, Math.min(100, score));
      return { score, met, rule, affinity, req, spent };
    }

    function badgeByScore(score){
      if (score >= 80) return { cls:"ok", label:"최적 혜택" };
      if (score >= 60) return { cls:"warn", label:"추천" };
      return { cls:"bad", label:"비추천" };
    }

    function renderResults(){
      const cat = categorySelect.value;
      if (!cat) {
        resultsEl.innerHTML = '<div class="muted-center">업종을 선택하고 버튼을 눌러주십시오.</div>';
        resultSub.textContent = "";
        return;
      }

      const store = pStore || "";
      const amountText = formatKRW(amountInput.value);

      // 서브라인
      const ctx = [];
      ctx.push(cat);
      if (pFrom === "qr" || pCategory) ctx.push("QR 진입");
      if (amountText) ctx.push(amountText);
      resultSub.textContent = ctx.join(" · ");

      const ranked = dummyCards
        .map(card => ({ card, ...computeScore(card, cat, store) }))
        .sort((a,b) => b.score - a.score);

      resultsEl.innerHTML = "";

      ranked.forEach((item, idx) => {
        const { card, score, met, rule, req, spent } = item;
        const badge = badgeByScore(score);

        const perfText = (req === 0)
          ? "전월실적 조건 없음"
          : (met
              ? `전월실적 ${req.toLocaleString('ko-KR')}원 충족`
              : `전월실적 미충족 (${Math.max(0, req - spent).toLocaleString('ko-KR')}원 부족)`);

        const benefitText = rule?.benefit || card.fallback;

        const div = document.createElement('div');
        div.className = `rec-card ${idx === 0 ? "top" : ""}`;
        div.innerHTML = `
          <div class="badge ${badge.cls}">${idx+1}순위 · ${badge.label} (${score}점)</div>
          <div class="rec-title">${card.name}</div>
          <div class="rec-meta">${card.issuer} · ${perfText}</div>
          <div class="benefit-highlight">
            <span style="font-weight:900;">혜택</span>
            <span style="font-weight:900;">${benefitText}</span>
          </div>
          <img src="./logo3.png?v=20260122" class="wm" alt="" aria-hidden="true" />
        `;
        resultsEl.appendChild(div);
      });
    }

    document.getElementById('btnRecommend').addEventListener('click', renderResults);

    document.getElementById('btnReset').addEventListener('click', () => {
      categorySelect.value = pCategory || "";
      amountInput.value = "";
      if (pCategory) {
        renderResults();
      } else {
        resultsEl.innerHTML = '<div class="muted-center">업종을 선택하고 버튼을 눌러주십시오.</div>';
        resultSub.textContent = "";
      }
    });

    // QR(category 존재)면 자동 렌더 (결제 직전 UX 고정)
    if (pCategory) renderResults();
  </script>
</body>
</html>

