<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¤ì¤: ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</title>
  <meta name="description" content="ê²°ì œ ì§ì „, ê°€ì¥ ìœ ë¦¬í•œ ê²°ì œìˆ˜ë‹¨ì„ ì¶”ì²œí•˜ëŠ” ì¤ì¤(JUPJUP)" />

  <link rel="icon" href="/logo1.png?v=2" type="image/png" />
  <link rel="apple-touch-icon" href="/logo1.png?v=2" />

  <style>
    :root {
      --bg: #f8f9fc;
      --card: #ffffff;
      --text: #101828;
      --muted: #475467;
      --line: #eaecf0;

      --brand: #FF6B00;
      --brand-weak: #fff1e6;
      --brand-dark: #E66000;

      --shadow: 0 12px 16px -4px rgba(16, 24, 40, 0.08);
      --radius: 20px;

      --ok: #027a48;
      --ok-bg: #ecfdf3;
      --warn: #b44d12;
      --warn-bg: #fffaeb;
      --bad: #b42318;
      --bad-bg: #fef3f2;

      --splash-top: #FF7A1A;
      --splash-bottom: #FFB46A;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* ===== Splash ===== */
    .splash {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(900px 520px at 50% 28%, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, var(--splash-top) 0%, var(--splash-bottom) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 400ms ease;
    }
    .splash.fade-out { opacity: 0; pointer-events: none; }

    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      text-align: center;
      padding: 24px 18px;
    }
    .splash img {
      width: 150px;
      height: 150px;
      object-fit: contain;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.14));
    }

    .splash-title {
      font-weight: 900;
      font-size: 35px;
      color: rgba(255,255,255,0.98);
      letter-spacing: -0.04em;
      line-height: 1.05;
      text-shadow: 0 10px 20px rgba(0,0,0,0.06);
    }
    .splash-subtitle {
      font-weight: 900;
      font-size: 21px;
      color: rgba(255,255,255,0.92);
      letter-spacing: -0.02em;
    }

    /* ===== Header ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--line);
    }
    .header-inner {
      max-width: 600px;
      margin: 0 auto;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 28px;
    }
    .brand img {
      width: 26px !important;
      height: 26px !important;
      display: block !important;
      object-fit: contain !important;
    }
    .brand .name {
      font-weight: 900;
      font-size: 16px;
      color: var(--brand);
      letter-spacing: -0.02em;
      white-space: nowrap;
    }
    .header-right {
      font-size: 12px;
      color: var(--muted);
      font-weight: 800;
      white-space: nowrap;
    }

    main {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px 16px;
    }
    .stack { display: flex; flex-direction: column; gap: 16px; }

    /* ===== UI Elements ===== */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      background: white;
      border: 1px solid var(--line);
      font-size: 14px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
      max-width: 100%;
    }
    .pill .dot { width: 8px; height: 8px; background: var(--brand); border-radius: 50%; }
    .pill strong { white-space: nowrap; }
    .pill span {
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .notice {
      background: var(--brand-weak);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--brand-dark);
      font-size: 13px;
      font-weight: 800;
      border: 1px solid rgba(255, 107, 0, 0.15);
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .panel h2 {
      margin: 0 0 16px;
      font-size: 15px;
      font-weight: 900;
      color: var(--muted);
      letter-spacing: -0.01em;
    }

    .form-grid { display: flex; flex-direction: column; gap: 16px; }
    label {
      display: block;
      font-size: 13px;
      font-weight: 800;
      color: var(--muted);
      margin-bottom: 6px;
    }
    select, input {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fff;
      font-size: 15px;
      outline: none;
      transition: all 0.2s;
    }
    select:focus, input:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--brand-weak); }

    .btn {
      width: 100%;
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-weight: 900;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
      position: relative;
    }
    .btn.primary { background: var(--brand); color: white; margin-top: 8px; }
    .btn.primary:active { background: var(--brand-dark); transform: scale(0.98); }
    .btn.ghost { background: transparent; color: var(--muted); padding: 10px 8px; font-size: 14px; font-weight: 900; }

    .btn:disabled { opacity: 0.65; cursor: not-allowed; }
    .btn.primary.loading { cursor: progress; }
    .btn.primary.loading::after{
      content:"";
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.55);
      border-top-color: rgba(255,255,255,1);
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      animation: jupupSpin 0.9s linear infinite;
    }
    @keyframes jupupSpin { to { transform: translateY(-50%) rotate(360deg); } }

    .rec-card {
      position: relative;
      border-radius: var(--radius);
      background: white;
      border: 1px solid var(--line);
      padding: 20px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .rec-card.top {
      border: 2px solid var(--brand);
      background: linear-gradient(180deg, #fff 0%, #fff9f5 100%);
      box-shadow: 0 10px 20px rgba(255,107,0,0.10);
      overflow: visible;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 900;
      margin-bottom: 12px;
    }
    .badge.ok { background: var(--ok-bg); color: var(--ok); }
    .badge.warn { background: var(--warn-bg); color: var(--warn); }
    .badge.bad { background: var(--bad-bg); color: var(--bad); }

    .rec-title { font-size: 18px; font-weight: 900; margin-bottom: 6px; letter-spacing: -0.02em; }
    .rec-meta { font-size: 13px; color: var(--muted); margin-bottom: 14px; font-weight: 800; }

    .rec-card.top::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: calc(var(--radius) + 2px);
      background: linear-gradient(
        110deg,
        rgba(255,107,0,0.25) 0%,
        rgba(255,107,0,0.95) 20%,
        rgba(255,255,255,0.85) 35%,
        rgba(255,107,0,0.95) 50%,
        rgba(255,107,0,0.25) 100%
      );
      background-size: 220% 220%;
      animation: jupupBorderShine 2.6s linear infinite;
      z-index: 0;

      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;

      padding: 2px;
      pointer-events:none;
    }

    .rec-card.top::after{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius: calc(var(--radius) + 10px);
      background: radial-gradient(
        60% 60% at 50% 30%,
        rgba(255,107,0,0.22) 0%,
        rgba(255,107,0,0.05) 55%,
        rgba(255,107,0,0) 75%
      );
      filter: blur(6px);
      opacity: .9;
      z-index: 0;
      pointer-events:none;
    }

    .rec-card.top > *{
      position: relative;
      z-index: 1;
    }

    @keyframes jupupBorderShine{
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @media (prefers-reduced-motion: reduce){
      .rec-card.top::before{ animation: none; }
    }

    .why {
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      margin: 0 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.35;
      flex-wrap: nowrap;
    }
    .why .chip {
      flex: 0 0 auto;
      font-size: 11px;
      font-weight: 900;
      color: var(--brand-dark);
      background: rgba(255,107,0,0.10);
      border: 1px solid rgba(255,107,0,0.18);
      padding: 3px 8px;
      border-radius: 999px;
      margin-top: 0;
      line-height: 1.25;
      white-space: nowrap;
    }
    .why .why-text{
      flex: 1 1 auto;
      min-width: 0;
      display: block;
      line-height: 1.35;
      word-break: keep-all;
    }

    .benefit-highlight {
      background: var(--brand-weak);
      color: var(--brand-dark);
      padding: 12px 12px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255, 107, 0, 0.18);
      flex-wrap: wrap;
    }

    /* âœ… AIì˜ˆìƒ í˜ì´ë°±: ë” êµµê²Œ/ì§„í•˜ê²Œ/í•œëˆˆì— */
    .ai-payback{
      width: 100%;
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255, 107, 0, 0.35);
      background: rgba(255, 255, 255, 0.78);

      font-size: 14px;
      font-weight: 1000;
      letter-spacing: -0.02em;

      color: #7A2E00;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }
    .ai-payback .label{
      font-size: 12px;
      font-weight: 1000;
      color: rgba(122, 46, 0, 0.92);
      white-space: nowrap;
    }
    .ai-payback .value{
      font-size: 18px;
      font-weight: 1000;
      color: var(--brand-dark);
      letter-spacing: -0.03em;
      white-space: nowrap;
    }

    .muted-center {
      text-align: center;
      padding: 40px 0;
      color: #98a2b3;
      font-size: 14px;
      font-weight: 900;
    }

    .pop { animation: popIn 240ms ease both; }
    @keyframes popIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    .wm { display: none !important; }

    /* âœ… ë”ì¹˜í˜ì´ UI (ì¶”ì²œì¹´ë“œ ë­í‚¹ ì•ˆì—ì„œë§Œ ì‚¬ìš©) */
    .dutch-box{
      margin-top: 0;
      border-radius: 14px;
      border: 1px solid rgba(255, 107, 0, 0.16);
      background: var(--brand-weak);
      padding: 10px;
    }
    .dutch-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom: 8px;
    }
    .dutch-title{
      font-size: 12px;
      font-weight: 900;
      color: var(--brand-dark);
      letter-spacing: -0.01em;
    }
    .dutch-total{
      font-size: 11px;
      font-weight: 900;
      color: rgba(230,96,0,0.92);
      white-space: nowrap;
    }
    .dutch-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .dutch-item{
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(255,255,255,0.92);
      border-radius: 12px;
      padding: 10px;
    }
    .dutch-item .n{
      font-size: 11px;
      font-weight: 900;
      color: var(--muted);
      margin-bottom: 3px;
    }
    .dutch-item .amt{
      font-size: 14px;
      font-weight: 900;
      color: var(--text);
      letter-spacing: -0.02em;
    }
    .dutch-foot{
      margin-top: 8px;
      font-size: 11px;
      font-weight: 800;
      color: rgba(71, 84, 103, 0.92);
      line-height: 1.45;
    }
  </style>
</head>

<body>
  <div class="splash" id="splash" aria-hidden="true">
    <div class="splash-content">
      <img src="/logo1.png" alt="ì¤ì¤ ìŠ¤í”Œë˜ì‹œ ë¡œê³ " />
      <div class="splash-title">ì¤ì¤:</div>
      <div class="splash-subtitle">ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</div>
    </div>
  </div>

  <header>
    <div class="header-inner">
      <div class="brand" aria-label="ì¤ì¤ í—¤ë”">
        <img src="/logo1.png?v=20260123" alt="ì¤ì¤ ë¡œê³ " />
        <div class="name">ì¤ì¤: ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</div>
      </div>
      <div class="header-right"></div>
    </div>
  </header>

  <main>
    <div class="stack">
      <div id="storeWrap" style="display:none;">
        <div class="pill" title="ë§¤ì¥ëª…">
          <span class="dot" aria-hidden="true"></span>
          <strong id="storeName">-</strong>
          <span>ì—ì„œ ê²°ì œ ì¤‘</span>
        </div>
      </div>

      <section class="panel" aria-label="ê²°ì œ ì •ë³´ ì…ë ¥">
        <div class="form-grid">
          <div>
            <label for="categorySelect">ê²°ì œ ì¥ì†Œ</label>
            <select id="categorySelect">
              <option value="">ê²°ì œ ì¥ì†Œ</option>
              <option value="ì¹´í˜">ì¹´í˜/ë””ì €íŠ¸</option>
              <option value="ìŒì‹ì ">ìŒì‹ì /ì‹ë‹¹</option>
              <option value="í¸ì˜ì ">í¸ì˜ì /ë§ˆíŠ¸</option>
              <option value="ëŒ€ì¤‘êµí†µ">ëŒ€ì¤‘êµí†µ</option>
              <option value="ì˜¨ë¼ì¸">ì˜¨ë¼ì¸ ì‡¼í•‘</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
          </div>

          <div>
            <label for="amountInput">ê²°ì œ(ì˜ˆìƒ) ê¸ˆì•¡</label>
            <input id="amountInput" type="text" inputmode="numeric" placeholder="ê²°ì œê¸ˆì•¡ì— ë”°ë¼ ìµœëŒ€ í˜œíƒì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”" />
          </div>
        </div>

        <button class="btn primary" id="btnRecommend">ì¹´ë“œ ì¶”ì²œë°›ê¸°</button>
        <button class="btn ghost" id="btnReset">ë‹¤ì‹œ ì„ íƒ</button>
      </section>

      <section class="panel" aria-label="ì¶”ì²œ ê²°ê³¼">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:10px;">
          <h2 style="margin:0;">ì¶”ì²œ ì¹´ë“œ ë­í‚¹</h2>
          <span id="resultSub" style="font-size:12px; color:var(--brand); font-weight:900; white-space:nowrap;"></span>
        </div>

        <div id="results">
          <div class="muted-center">ì ë“¤ì–´ ìˆëŠ” ìˆ¨ì€ ë‚´ ì¹´ë“œ í˜œíƒì„ ê¹¨ì›Œì£¼ì„¸ìš”!.</div>
        </div>
      </section>
    </div>
  </main>

  <script>
    window.addEventListener('load', () => {
      setTimeout(() => {
        const s = document.getElementById('splash');
        s.classList.add('fade-out');
        setTimeout(() => s.style.display = 'none', 420);
      }, 900);
    });

    const params = new URLSearchParams(window.location.search);

    function safeDecode(value){
      try { return decodeURIComponent(value || ''); } catch(e){ return value || ''; }
    }

    function normalizeCategory(v){
      const s = (v || '').trim();
      const allowed = ["ì¹´í˜","ìŒì‹ì ","í¸ì˜ì ","ëŒ€ì¤‘êµí†µ","ì˜¨ë¼ì¸","ê¸°íƒ€"];
      if (allowed.includes(s)) return s;
      const map = { "ì¹´í˜/ë””ì €íŠ¸":"ì¹´í˜", "ì‹ë‹¹":"ìŒì‹ì ", "ë ˆìŠ¤í† ë‘":"ìŒì‹ì " };
      return map[s] || "";
    }

    function digitsOnly(v){
      return String(v || '').replace(/[^0-9]/g, '');
    }

    function formatKRW(v){
      const n = Number(digitsOnly(v));
      if (!Number.isFinite(n) || n <= 0) return '';
      return n.toLocaleString('ko-KR') + 'ì›';
    }

    function parsePercentFromText(text){
      const t = String(text || '');
      const m = t.match(/([0-9]+(?:\.[0-9]+)?)\s*%/);
      if (!m) return null;
      const p = Number(m[1]);
      if (!Number.isFinite(p) || p <= 0) return null;
      return p;
    }

    function estimatePayback(amount, benefitText){
      const a = Number(amount);
      if (!Number.isFinite(a) || a <= 0) return null;
      const pct = parsePercentFromText(benefitText);
      const rate = (pct === null) ? 0.7 : pct;
      return Math.floor(a * rate / 100);
    }

    const pFrom = (params.get('from') || '').trim().toLowerCase();
    const pStore = safeDecode(params.get('store') || '').trim();
    const pCategory = normalizeCategory(safeDecode(params.get('category') || '').trim());

    const categorySelect = document.getElementById('categorySelect');
    const amountInput = document.getElementById('amountInput');
    const resultsEl = document.getElementById('results');
    const resultSub = document.getElementById('resultSub');

    const storeWrap = document.getElementById('storeWrap');
    const storeName = document.getElementById('storeName');

    const btnRecommend = document.getElementById('btnRecommend');
    const btnReset = document.getElementById('btnReset');

    let hasRecommended = false;

    if (pStore) {
      storeName.textContent = pStore;
      storeWrap.style.display = 'block';
    }

    if (pCategory) {
      categorySelect.value = pCategory;
    }

    function buildDutchInline(n){
      if (!Number.isFinite(n) || n <= 0) return null;

      const wrap = document.createElement('div');
      wrap.className = 'rec-card pop';
      wrap.innerHTML = `
        <div class="badge warn">ë”ì¹˜í˜ì´ Â· ë¹ ë¥¸ ê³„ì‚°</div>
        <div class="dutch-box" aria-label="ë”ì¹˜í˜ì´ ê³„ì‚°">
          <div class="dutch-head">
            <div class="dutch-title">ë”ì¹˜í˜ì´ ê³„ì‚°</div>
            <div class="dutch-total">ì´ì•¡ ${n.toLocaleString('ko-KR')}ì›</div>
          </div>
          <div class="dutch-grid"></div>
          <div class="dutch-foot">â€» 1ì¸ë‹¹ ê¸ˆì•¡ì€ ì› ë‹¨ìœ„ ë‚´ë¦¼ ê¸°ì¤€ì…ë‹ˆë‹¤.</div>
        </div>
      `;

      const grid = wrap.querySelector('.dutch-grid');
      for (let people = 2; people <= 5; people++){
        const per = Math.floor(n / people);
        const remainder = n - (per * people);

        const div = document.createElement('div');
        div.className = 'dutch-item';
        div.innerHTML = `
          <div class="n">ğŸ‘¥ ${people}ëª…</div>
          <div class="amt">${per.toLocaleString('ko-KR')}ì›</div>
          <div style="margin-top:5px; font-size:11px; font-weight:800; color:rgba(71,84,103,0.9);">
            ë‚¨ëŠ” ê¸ˆì•¡: ${remainder.toLocaleString('ko-KR')}ì›
          </div>
        `;
        grid.appendChild(div);
      }

      return wrap;
    }

    amountInput.addEventListener('input', () => {
      amountInput.value = digitsOnly(amountInput.value);
    });

    const dummyCards = [
      /* ===== ì‹ í•œ (3) ===== */
      {
        issuer: "ì‹ í•œ",
        name: "ì‹ í•œì¹´ë“œ Deep Dream",
        requirements: { monthlySpendMin: 0 },
        user: { monthlySpent: 0 },
        source: { issuerSite: "ì‹ í•œì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ì¹´í˜"], benefit:"ê¸°ë³¸ 0.7% ì ë¦½ + (ì„ íƒì˜ì—­) ì¹´í˜ ë“± ì¶”ê°€ ì ë¦½(ëŒ€í‘œ)" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ê¸°ë³¸ 0.7% ì ë¦½ + (ì„ íƒì˜ì—­) ì˜¨ë¼ì¸ ë“± ì¶”ê°€ ì ë¦½(ëŒ€í‘œ)" },
          { category:["ê¸°íƒ€"], benefit:"êµ­ë‚´/í•´ì™¸ ì „ ê°€ë§¹ì  ê¸°ë³¸ 0.7% ì ë¦½(ëŒ€í‘œ)" }
        ],
        fallback: "êµ­ë‚´/í•´ì™¸ ì „ ê°€ë§¹ì  ê¸°ë³¸ 0.7% ì ë¦½(ëŒ€í‘œ)"
      },
      {
        issuer: "ì‹ í•œ",
        name: "ì‹ í•œì¹´ë“œ Mr.Life",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 420000 },
        source: { issuerSite: "ì‹ í•œì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  10% í• ì¸(ëŒ€í‘œ) Â· ì‹œê°„/íšŸìˆ˜/í•œë„ ì¡°ê±´ ìˆìŒ" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ì˜¨ë¼ì¸ ì‡¼í•‘ 10% í• ì¸(ëŒ€í‘œ) Â· ì‹œê°„/í•œë„ ì¡°ê±´ ìˆìŒ" },
          { category:["ìŒì‹ì "], benefit:"ì‹ìŒë£Œ ì—…ì¢… 10% í• ì¸(ëŒ€í‘œ) Â· ì‹œê°„/í•œë„ ì¡°ê±´ ìˆìŒ" }
        ],
        fallback: "ìƒí™œ ë°€ì°© í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "ì‹ í•œ",
        name: "ì‹ í•œì¹´ë“œ ì²˜ìŒ",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 260000 },
        source: { issuerSite: "ì‹ í•œì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ìŒì‹ì "], benefit:"ìŒì‹ì  5% ì ë¦½(ëŒ€í‘œ) Â· ì›” í•œë„/ì¡°ê±´ ìˆìŒ" },
          { category:["ì¹´í˜"], benefit:"ì»¤í”¼ì „ë¬¸ì  5% ì ë¦½(ëŒ€í‘œ) Â· ì›” í•œë„/ì¡°ê±´ ìˆìŒ" },
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  5% ì ë¦½(ëŒ€í‘œ) Â· ì›” í•œë„/ì¡°ê±´ ìˆìŒ" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ì˜¨ë¼ì¸ ì‡¼í•‘ 5% ì ë¦½(ëŒ€í‘œ) Â· ì›” í•œë„/ì¡°ê±´ ìˆìŒ" }
        ],
        fallback: "ìƒí™œ ì˜ì—­ ì ë¦½(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },

      /* ===== êµ­ë¯¼ (3) ===== */
      {
        issuer: "êµ­ë¯¼",
        name: "KBêµ­ë¯¼ íƒ„íƒ„ëŒ€ë¡œ ì›°ì»´ì¹´ë“œ",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 320000 },
        source: { issuerSite: "KBêµ­ë¯¼ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì /í•œë„ ì¡°ê±´ ìˆìŒ" },
          { category:["ëŒ€ì¤‘êµí†µ"], benefit:"ëŒ€ì¤‘êµí†µÂ·íƒì‹œ 5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì /í•œë„ ì¡°ê±´ ìˆìŒ" },
          { category:["ìŒì‹ì "], benefit:"ìŒì‹(ìŒì‹ì ) 5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì /í•œë„ ì¡°ê±´ ìˆìŒ" }
        ],
        fallback: "ìƒí™œ ì˜ì—­ ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "êµ­ë¯¼",
        name: "KBêµ­ë¯¼ ì²­ì¶˜ëŒ€ë¡œ í†¡í†¡ì¹´ë“œ",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 350000 },
        source: { issuerSite: "KBêµ­ë¯¼ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ì¹´í˜"], benefit:"ì¹´í˜/ë² ì´ì»¤ë¦¬ 10% í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["ëŒ€ì¤‘êµí†µ"], benefit:"ëŒ€ì¤‘êµí†µÂ·íƒì‹œ 10% í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" }
        ],
        fallback: "MZ ìƒí™œì˜ì—­ í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "êµ­ë¯¼",
        name: "KBêµ­ë¯¼ íƒ„íƒ„ëŒ€ë¡œ ì˜¬ì‡¼í•‘ì¹´ë“œ",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 260000 },
        source: { issuerSite: "KBêµ­ë¯¼ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ì˜¨ë¼ì¸"], benefit:"ì‡¼í•‘ ì˜ì—­ ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["ì¹´í˜"], benefit:"ì»¤í”¼ ì—…ì¢… 5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" }
        ],
        fallback: "ì‡¼í•‘/ë°ì¼ë¦¬ ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },

      /* ===== ìš°ë¦¬ (3) ===== */
      {
        issuer: "ìš°ë¦¬",
        name: "ìš°ë¦¬ì¹´ë“œ ì¹´ë“œì˜ì •ì„ TEN",
        requirements: { monthlySpendMin: 400000 },
        user: { monthlySpent: 420000 },
        source: { issuerSite: "ìš°ë¦¬ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ì¹´í˜"], benefit:"ì»¤í”¼ 10% ì²­êµ¬í• ì¸(TEN Discount) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  10% ì²­êµ¬í• ì¸(TEN Discount) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["ëŒ€ì¤‘êµí†µ"], benefit:"ë²„ìŠ¤/ì§€í•˜ì² /íƒì‹œ 10% ì²­êµ¬í• ì¸(TEN Discount) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ì˜¨ë¼ì¸(í•´ì™¸ í¬í•¨) 10% ì²­êµ¬í• ì¸(TEN Discount) Â· ì¡°ê±´/í•œë„ ìˆìŒ" }
        ],
        fallback: "TEN Discount ëŒ€í‘œ ì²­êµ¬í• ì¸ Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "ìš°ë¦¬",
        name: "ìš°ë¦¬ì¹´ë“œ ì¹´ë“œì˜ì •ì„ POINT",
        requirements: { monthlySpendMin: 0 },
        user: { monthlySpent: 0 },
        source: { issuerSite: "ìš°ë¦¬ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ê¸°íƒ€"], benefit:"ê¸°ë³¸ ì ë¦½(ëŒ€í‘œ) Â· ì ë¦½í•œë„ ì—†ì´ ê¸°ë³¸ ê°€ë§¹ì  í¬ì¸íŠ¸ ì ë¦½" },
          { category:["ì¹´í˜"], benefit:"íŠ¹ë³„ ì—…ì¢… í¬ì¸íŠ¸ ì ë¦½(ëŒ€í‘œ) Â· ìµœëŒ€ 5% ìˆ˜ì¤€(ì¡°ê±´/í•œë„ ìˆìŒ)" },
          { category:["ì˜¨ë¼ì¸"], benefit:"íŠ¹ë³„ ì—…ì¢… í¬ì¸íŠ¸ ì ë¦½(ëŒ€í‘œ) Â· ìµœëŒ€ 5% ìˆ˜ì¤€(ì¡°ê±´/í•œë„ ìˆìŒ)" }
        ],
        fallback: "ê¸°ë³¸ í¬ì¸íŠ¸ ì ë¦½(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì¹´ë“œ ì•½ê´€ ê¸°ì¤€"
      },
      {
        issuer: "ìš°ë¦¬",
        name: "ìš°ë¦¬ì¹´ë“œ ì¹´ë“œì˜ì •ì„ ì‹œì¦Œ2",
        requirements: { monthlySpendMin: 0 },
        user: { monthlySpent: 0 },
        source: { issuerSite: "ìš°ë¦¬ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ê¸°íƒ€"], benefit:"êµ­ë‚´ì™¸ ê°€ë§¹ì  1.2% ì²­êµ¬í• ì¸(ëŒ€í‘œ)" },
          { category:["ì˜¨ë¼ì¸"], benefit:"êµ­ë‚´ì™¸ ê°€ë§¹ì  1.2% ì²­êµ¬í• ì¸(ëŒ€í‘œ)" }
        ],
        fallback: "êµ­ë‚´ì™¸ ê°€ë§¹ì  1.2% ì²­êµ¬í• ì¸(ëŒ€í‘œ)"
      },

      /* ===== ë†í˜‘ (3) ===== */
      {
        issuer: "ë†í˜‘",
        name: "NHë†í˜‘ ì˜¬ë°”ë¥¸ FLEX ì¹´ë“œ",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 280000 },
        source: { issuerSite: "NHë†í˜‘ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ì¹´í˜"], benefit:"ìŠ¤íƒ€ë²…ìŠ¤ 50% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ìƒí™œ/êµ¬ë… ì˜ì—­ ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" }
        ],
        fallback: "ìƒí™œ êµ¬ë…/ì·¨í–¥ í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "ë†í˜‘",
        name: "NHë†í˜‘ ì˜¬ë°”ë¥¸ MYPICK ì¹´ë“œ",
        requirements: { monthlySpendMin: 400000 },
        user: { monthlySpent: 420000 },
        source: { issuerSite: "NHë†í˜‘ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ì¹´í˜"], benefit:"ì»¤í”¼(ìŠ¤íƒ€ë²…ìŠ¤ í¬í•¨) 5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· í†µí•© í•œë„ ìˆìŒ" },
          { category:["ëŒ€ì¤‘êµí†µ"], benefit:"ëŒ€ì¤‘êµí†µ/íƒì‹œ 5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· í†µí•© í•œë„ ìˆìŒ" },
          { category:["ì˜¨ë¼ì¸"], benefit:"í•´ì™¸(ì§êµ¬/ì˜¨ë¼ì¸ í¬í•¨) 5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· í†µí•© í•œë„ ìˆìŒ" }
        ],
        fallback: "í•´ì™¸/ì»¤í”¼/êµí†µ 5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í†µí•©í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "ë†í˜‘",
        name: "NHë†í˜‘ ì˜¬ë°”ë¥¸ MYPICK ì¹´ë“œ(í‘¸ë“œ/í¸ì˜ì )",
        requirements: { monthlySpendMin: 400000 },
        user: { monthlySpent: 260000 },
        source: { issuerSite: "NHë†í˜‘ì¹´ë“œ", note: "ê³µì‹ í˜œíƒ ë°©í–¥ì„ MVPìš©ìœ¼ë¡œ ìš”ì•½í•œ ë¬¸êµ¬ì…ë‹ˆë‹¤." },
        rules: [
          { category:["ìŒì‹ì "], benefit:"ìŒì‹ì  5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" },
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ ìˆìŒ" }
        ],
        fallback: "ì„ íƒ PACK ê¸°ë°˜ í• ì¸(ëŒ€í‘œ) Â· ì¡°ê±´/í•œë„ëŠ” ì‹¤ì  êµ¬ê°„ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      }
    ];

    function inferIssuerAffinity(store){
      const s = (store || "").toLowerCase();
      if (s.includes("ìŠ¤íƒ€ë²…ìŠ¤") || s.includes("starbucks")) return "ì‹ í•œ";
      if (s.includes("gs") || s.includes("gs25")) return "êµ­ë¯¼";
      if (s.includes("cu")) return "í˜„ëŒ€";
      return "";
    }

    function findRule(card, category){
      return card.rules.find(r => (r.category || []).includes(category)) || null;
    }

    /* =========================
       âœ… ì¶”ì²œ ë­í‚¹ ë¡œì§: ë³€ê²½ ì—†ìŒ
       ========================= */
    function computeScore(card, category, store){
      let score = 0;

      const rule = findRule(card, category);
      score += rule ? 55 : 15;

      const req = Number(card.requirements?.monthlySpendMin || 0);
      const spent = Number(card.user?.monthlySpent || 0);
      const met = (req === 0) ? true : (spent >= req);
      score += met ? 25 : -10;

      const affinity = inferIssuerAffinity(store);
      if (affinity && affinity === card.issuer) score += 12;

      score = Math.max(0, Math.min(100, score));
      return { score, met, rule, req, spent };
    }

    function badgeByScore(score){
      if (score >= 80) return { cls:"ok", label:"ìµœì  í˜œíƒ" };
      if (score >= 60) return { cls:"warn", label:"ì¶”ì²œ" };
      return { cls:"bad", label:"ë¹„ì¶”ì²œ" };
    }

    function buildWhyText(item, category, store){
      const parts = [];
      parts.push(item.rule ? `${category} í˜œíƒ ì¼ì¹˜` : `${category} í˜œíƒ ì•½í•¨`);
      if (item.req === 0) parts.push("ì „ì›”ì‹¤ì  ì¡°ê±´ ì—†ìŒ");
      else parts.push(item.met ? "ì „ì›”ì‹¤ì  ì¶©ì¡±" : "ì „ì›”ì‹¤ì  ë¯¸ì¶©ì¡±");

      const affinity = inferIssuerAffinity(store || "");
      if (affinity && affinity === item.card.issuer) parts.push("ë§¤ì¥-ì¹´ë“œì‚¬ ì¶”ì • ì¼ì¹˜");

      return parts.slice(0, 3).join(" Â· ");
    }

    function showIdleResults(){
      resultsEl.innerHTML = '<div class="muted-center">ì¤ì¤ì€ ì ë“¤ì–´ ìˆëŠ” ë‚´ ì¹´ë“œí˜œíƒì„ ë¬´ë£Œë¡œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.</div>';
      resultSub.textContent = "";
    }

    function showLoadingResults(){
      resultsEl.innerHTML = '<div class="muted-center">1ì´ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</div>';
    }

    function renderResults(){
      const cat = categorySelect.value;
      if (!cat) {
        showIdleResults();
        return;
      }

      const amountText = formatKRW(amountInput.value);
      const ctx = [cat];
      if (pFrom === "qr" || pCategory) ctx.push("QR ì§„ì…");
      if (amountText) ctx.push(amountText);
      resultSub.textContent = ctx.join(" Â· ");

      const storeForScore = (pStore || "ìŠ¤íƒ€ë²…ìŠ¤");

      const ranked = dummyCards
        .map(card => ({ card, ...computeScore(card, cat, storeForScore) }))
        .sort((a,b) => b.score - a.score);

      resultsEl.innerHTML = "";

      const nForDutch = Number(digitsOnly(amountInput.value));
      const dutchInline = (!Number.isFinite(nForDutch) || nForDutch <= 0) ? null : buildDutchInline(nForDutch);

      ranked.forEach((item, idx) => {
        const { card, score, met, rule, req, spent } = item;
        const badge = badgeByScore(score);

        const perfText = (req === 0)
          ? "ì „ì›”ì‹¤ì  ì¡°ê±´ ì—†ìŒ"
          : (met
              ? `ì „ì›”ì‹¤ì  ${req.toLocaleString('ko-KR')}ì› ì¶©ì¡±`
              : `ì „ì›”ì‹¤ì  ë¯¸ì¶©ì¡± (${Math.max(0, req - spent).toLocaleString('ko-KR')}ì› ë¶€ì¡±)`);

        const benefitText = rule?.benefit || card.fallback;
        const whyText = (idx === 0) ? buildWhyText(item, cat, pStore || "") : "";

        const pay = estimatePayback(Number(digitsOnly(amountInput.value)), benefitText);
        const payHtml = (pay === null) ? "" : `
          <div class="ai-payback">
            <span class="label">AIì˜ˆìƒ í˜ì´ë°±ê¸ˆì•¡</span>
            <span class="value">${pay.toLocaleString('ko-KR')}ì›</span>
          </div>
        `;

        const div = document.createElement('div');
        div.className = `rec-card pop ${idx === 0 ? "top" : ""}`;
        div.innerHTML = `
          <div class="badge ${badge.cls}">${idx+1}ìˆœìœ„ Â· ${badge.label} (${score}ì )</div>
          <div class="rec-title">${card.name}</div>
          <div class="rec-meta">${card.issuer} Â· ${perfText}</div>
          ${idx === 0 ? `<div class="why"><span class="chip">WHY?</span><span class="why-text">${whyText}</span></div>` : ``}
          <div class="benefit-highlight">ğŸ’° ${benefitText}${payHtml}</div>
        `;
        resultsEl.appendChild(div);

        if (idx === 1 && dutchInline) {
          resultsEl.appendChild(dutchInline);
        }
      });
    }

    function refreshCTA(){
      const hasCat = !!(categorySelect.value || "").trim();
      const isLoading = btnRecommend.classList.contains("loading");
      btnRecommend.disabled = !hasCat || isLoading;
    }

    function setCTALoading(on){
      if (on){
        btnRecommend.classList.add("loading");
        btnRecommend.dataset.prevText = btnRecommend.textContent;
        btnRecommend.textContent = "í˜œíƒ ê³„ì‚° ì¤‘â€¦";
        btnRecommend.disabled = true;
      } else {
        btnRecommend.classList.remove("loading");
        btnRecommend.textContent = btnRecommend.dataset.prevText || "ì¹´ë“œ ì¶”ì²œë°›ê¸°";
        refreshCTA();
      }
    }

    btnRecommend.addEventListener('click', () => {
      refreshCTA();
      if (btnRecommend.disabled) return;

      hasRecommended = true;

      setCTALoading(true);
      showLoadingResults();
      setTimeout(() => {
        renderResults();
        setCTALoading(false);
      }, 1000);
    });

    btnReset.addEventListener('click', () => {
      categorySelect.value = pCategory || "";
      amountInput.value = "";
      hasRecommended = false;

      showIdleResults();
      refreshCTA();
    });

    categorySelect.addEventListener('change', () => {
      refreshCTA();
      if (!hasRecommended) showIdleResults();
    });

    refreshCTA();
    showIdleResults();
  </script>
</body>
</html>
