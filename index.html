<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¤ì¤: ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</title>
  <meta name="description" content="ê²°ì œ ì§ì „, ê°€ì¥ ìœ ë¦¬í•œ ê²°ì œìˆ˜ë‹¨ì„ ì¶”ì²œí•˜ëŠ” ì¤ì¤(JUPJUP)" />

  <link rel="icon" href="/logo1.png?v=2" type="image/png" />
  <link rel="apple-touch-icon" href="/logo1.png?v=2" />

  <style>
    :root {
      --bg: #f8f9fc;
      --card: #ffffff;
      --text: #101828;
      --muted: #475467;
      --line: #eaecf0;

      --brand: #FF6B00;
      --brand-weak: #fff1e6;
      --brand-dark: #E66000;

      --shadow: 0 12px 16px -4px rgba(16, 24, 40, 0.08);
      --radius: 20px;

      --ok: #027a48;
      --ok-bg: #ecfdf3;
      --warn: #b44d12;
      --warn-bg: #fffaeb;
      --bad: #b42318;
      --bad-bg: #fef3f2;

      --splash-top: #FF7A1A;
      --splash-bottom: #FFB46A;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* ===== Splash ===== */
    .splash {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(900px 520px at 50% 28%, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, var(--splash-top) 0%, var(--splash-bottom) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 400ms ease;
    }
    .splash.fade-out { opacity: 0; pointer-events: none; }

    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      text-align: center;
      padding: 24px 18px;
    }
    .splash img {
      width: 150px;
      height: 150px;
      object-fit: contain;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.14));
    }

    .splash-title {
      font-weight: 900;
      font-size: 35px;
      color: rgba(255,255,255,0.98);
      letter-spacing: -0.04em;
      line-height: 1.05;
      text-shadow: 0 10px 20px rgba(0,0,0,0.06);
    }
    .splash-subtitle {
      font-weight: 900;
      font-size: 21px;
      color: rgba(255,255,255,0.92);
      letter-spacing: -0.02em;
    }

    /* ===== Header ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--line);
    }
    .header-inner {
      max-width: 600px;
      margin: 0 auto;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 28px;
    }
    .brand img {
      width: 26px !important;
      height: 26px !important;
      display: block !important;
      object-fit: contain !important;
    }
    .brand .name {
      font-weight: 900;
      font-size: 16px;
      color: var(--brand);
      letter-spacing: -0.02em;
      white-space: nowrap;
    }
    .header-right {
      font-size: 12px;
      color: var(--muted);
      font-weight: 800;
      white-space: nowrap;
    }

    main {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px 16px;
    }
    .stack { display: flex; flex-direction: column; gap: 16px; }

    /* ===== UI Elements ===== */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      background: white;
      border: 1px solid var(--line);
      font-size: 14px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
      max-width: 100%;
    }
    .pill .dot { width: 8px; height: 8px; background: var(--brand); border-radius: 50%; }
    .pill strong { white-space: nowrap; }
    .pill span {
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .notice {
      background: var(--brand-weak);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--brand-dark);
      font-size: 13px;
      font-weight: 800;
      border: 1px solid rgba(255, 107, 0, 0.15);
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .panel h2 {
      margin: 0 0 16px;
      font-size: 15px;
      font-weight: 900;
      color: var(--muted);
      letter-spacing: -0.01em;
    }

    .form-grid { display: flex; flex-direction: column; gap: 14px; }
    label {
      display: block;
      font-size: 13px;
      font-weight: 800;
      color: var(--muted);
      margin-bottom: 6px;
    }

    /* âœ… ì…ë ¥ ë°”(ê²°ì œ ì¥ì†Œ/ê¸ˆì•¡) ì–‡ê²Œ */
    select, input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.2s;
      line-height: 1.2;
    }
    select:focus, input:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--brand-weak); }

    .btn {
      width: 100%;
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-weight: 900;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
      position: relative;
    }
    .btn.primary { background: var(--brand); color: white; margin-top: 8px; }
    .btn.primary:active { background: var(--brand-dark); transform: scale(0.98); }
    .btn.ghost { background: transparent; color: var(--muted); padding: 10px 8px; font-size: 14px; font-weight: 900; }

    .btn:disabled { opacity: 0.65; cursor: not-allowed; }
    .btn.primary.loading { cursor: progress; }
    .btn.primary.loading::after{
      content:"";
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.55);
      border-top-color: rgba(255,255,255,1);
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      animation: jupupSpin 0.9s linear infinite;
    }
    @keyframes jupupSpin { to { transform: translateY(-50%) rotate(360deg); } }

    .rec-card {
      position: relative;
      border-radius: var(--radius);
      background: white;
      border: 1px solid var(--line);
      padding: 20px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .rec-card.top {
      border: 2px solid var(--brand);
      background: linear-gradient(180deg, #fff 0%, #fff9f5 100%);
      box-shadow: 0 10px 20px rgba(255,107,0,0.10);
      overflow: visible;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 900;
      margin-bottom: 12px;
    }
    .badge.ok { background: var(--ok-bg); color: var(--ok); }
    .badge.warn { background: var(--warn-bg); color: var(--warn); }
    .badge.bad { background: var(--bad-bg); color: var(--bad); }

    .rec-title { font-size: 18px; font-weight: 900; margin-bottom: 6px; letter-spacing: -0.02em; }
    .rec-meta { font-size: 13px; color: var(--muted); margin-bottom: 14px; font-weight: 800; }

    .rec-card.top::before{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: calc(var(--radius) + 2px);
      background: linear-gradient(
        110deg,
        rgba(255,107,0,0.25) 0%,
        rgba(255,107,0,0.95) 20%,
        rgba(255,255,255,0.85) 35%,
        rgba(255,107,0,0.95) 50%,
        rgba(255,107,0,0.25) 100%
      );
      background-size: 220% 220%;
      animation: jupupBorderShine 2.6s linear infinite;
      z-index: 0;

      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;

      padding: 2px;
      pointer-events:none;
    }

    .rec-card.top::after{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius: calc(var(--radius) + 10px);
      background: radial-gradient(
        60% 60% at 50% 30%,
        rgba(255,107,0,0.22) 0%,
        rgba(255,107,0,0.05) 55%,
        rgba(255,107,0,0) 75%
      );
      filter: blur(6px);
      opacity: .9;
      z-index: 0;
      pointer-events:none;
    }

    .rec-card.top > *{
      position: relative;
      z-index: 1;
    }

    @keyframes jupupBorderShine{
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @media (prefers-reduced-motion: reduce){
      .rec-card.top::before{ animation: none; }
    }

    .why {
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      margin: 0 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1.35;
      flex-wrap: nowrap;
    }
    .why .chip {
      flex: 0 0 auto;
      font-size: 11px;
      font-weight: 900;
      color: var(--brand-dark);
      background: rgba(255,107,0,0.10);
      border: 1px solid rgba(255,107,0,0.18);
      padding: 3px 8px;
      border-radius: 999px;
      margin-top: 0;
      line-height: 1.25;
      white-space: nowrap;
    }
    .why .why-text{
      flex: 1 1 auto;
      min-width: 0;
      display: block;
      line-height: 1.35;
      word-break: keep-all;
    }

    .benefit-highlight {
      background: var(--brand-weak);
      color: var(--brand-dark);
      padding: 12px 12px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255, 107, 0, 0.18);
    }

    /* âœ… AI ì˜ˆìƒ í˜ì´ë°± ê°•ì¡° (ê¸°ì¡´ UI í†¤ ìœ ì§€) */
    .payback-highlight{
      margin-top: 10px;
      background: rgba(255,255,255,0.85);
      border: 1px solid rgba(255, 107, 0, 0.18);
      border-radius: 12px;
      padding: 12px 12px;
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    .payback-top{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 10px;
      flex-wrap: nowrap;
    }
    .payback-label{
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      white-space: nowrap;
    }
    .payback-amt{
      font-size: 18px;
      font-weight: 900;
      color: var(--brand-dark);
      letter-spacing: -0.02em;
      white-space: nowrap;
    }
    .payback-foot{
      font-size: 11px;
      font-weight: 800;
      color: rgba(71, 84, 103, 0.92);
      line-height: 1.45;
    }

    .muted-center {
      text-align: center;
      padding: 40px 0;
      color: #98a2b3;
      font-size: 14px;
      font-weight: 900;
    }

    .pop { animation: popIn 240ms ease both; }
    @keyframes popIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    .wm { display: none !important; }

    /* âœ… ë”ì¹˜í˜ì´ UI (ì¶”ì²œì¹´ë“œ ë­í‚¹ ì•ˆì—ì„œë§Œ ì‚¬ìš©) */
    .dutch-box{
      margin-top: 0;
      border-radius: 14px;
      border: 1px solid rgba(255, 107, 0, 0.16);
      background: var(--brand-weak);
      padding: 10px;
    }
    .dutch-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom: 8px;
    }
    .dutch-title{
      font-size: 12px;
      font-weight: 900;
      color: var(--brand-dark);
      letter-spacing: -0.01em;
    }
    .dutch-total{
      font-size: 11px;
      font-weight: 900;
      color: rgba(230,96,0,0.92);
      white-space: nowrap;
    }
    .dutch-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .dutch-item{
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(255,255,255,0.92);
      border-radius: 12px;
      padding: 10px;
    }
    .dutch-item .n{
      font-size: 11px;
      font-weight: 900;
      color: var(--muted);
      margin-bottom: 3px;
    }
    .dutch-item .amt{
      font-size: 14px;
      font-weight: 900;
      color: var(--text);
      letter-spacing: -0.02em;
    }
    .dutch-foot{
      margin-top: 8px;
      font-size: 11px;
      font-weight: 800;
      color: rgba(71, 84, 103, 0.92);
      line-height: 1.45;
    }

    /* âœ… ìŠ¤í¬ë¡¤ ìœ ë„ CTA (ì˜êµ¬ í‘œì‹œ + ë” ìƒìƒí•˜ê²Œ) */
    .scroll-cta {
      position: fixed;
      left: 50%;
      bottom: 8px;
      transform: translateX(-50%);
      z-index: 120;
      width: min(520px, calc(100% - 28px));
      display: none;
      pointer-events: none;
    }
    .scroll-cta .inner {
      pointer-events: auto;
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(255,107,0,0.28);
      background:
        radial-gradient(220px 80px at 20% 30%, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(90deg, rgba(255,107,0,0.18) 0%, rgba(255,255,255,0.92) 38%, rgba(255,107,0,0.10) 100%);
      backdrop-filter: blur(10px);
      padding: 8px 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 14px 24px rgba(16,24,40,0.14);
      position: relative;
      overflow: hidden;
      animation: ctaFloat 2.2s ease-in-out infinite;
    }

    /* ì€ì€í•œ ë¹› ìŠ¤ìœ• */
    .scroll-cta .inner::before{
      content:"";
      position:absolute;
      top:-40%;
      left:-30%;
      width: 60%;
      height: 180%;
      background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.55) 50%, rgba(255,255,255,0) 100%);
      transform: rotate(18deg);
      animation: ctaSweep 2.4s ease-in-out infinite;
      pointer-events:none;
      opacity: 0.9;
    }

    .scroll-cta .t {
      position: relative;
      z-index: 1;
      font-size: 12px;
      font-weight: 1000;
      color: var(--brand-dark);
      letter-spacing: -0.01em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-shadow: 0 8px 18px rgba(16,24,40,0.14);
    }

    .scroll-cta .chev {
      position: relative;
      z-index: 1;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, rgba(255,107,0,0.95) 0%, rgba(230,96,0,0.95) 100%);
      border: 1px solid rgba(255,255,255,0.55);
      color: rgba(255,255,255,0.98);
      font-size: 14px;
      line-height: 1;
      box-shadow: 0 10px 18px rgba(255,107,0,0.28), 0 10px 18px rgba(16,24,40,0.10);
      animation: jupupBopStrong 1.1s ease-in-out infinite;
      flex: 0 0 auto;
    }

    @keyframes jupupBopStrong {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }

    @keyframes ctaFloat {
      0%, 100% { transform: translateX(0) translateY(0); }
      50% { transform: translateX(0) translateY(-2px); }
    }

    @keyframes ctaSweep {
      0% { transform: translateX(-40%) rotate(18deg); opacity: 0; }
      30% { opacity: 0.9; }
      60% { opacity: 0.9; }
      100% { transform: translateX(190%) rotate(18deg); opacity: 0; }
    }

    @media (prefers-reduced-motion: reduce){
      .scroll-cta .inner{ animation: none; }
      .scroll-cta .inner::before{ animation: none; }
      .scroll-cta .chev{ animation: none; }
    }

    .pad-bottom { padding-bottom: 28px; }
  </style>
</head>

<body>
  <div class="splash" id="splash" aria-hidden="true">
    <div class="splash-content">
      <img src="/logo1.png" alt="ì¤ì¤ ìŠ¤í”Œë˜ì‹œ ë¡œê³ " />
      <div class="splash-title">ì¤ì¤:</div>
      <div class="splash-subtitle">ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</div>
    </div>
  </div>

  <header>
    <div class="header-inner">
      <div class="brand" aria-label="ì¤ì¤ í—¤ë”">
        <img src="/logo1.png?v=20260123" alt="ì¤ì¤ ë¡œê³ " />
        <div class="name">ì¤ì¤: ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</div>
      </div>
      <div class="header-right"></div>
    </div>
  </header>

  <main id="main">
    <div class="stack">
      <div id="storeWrap" style="display:none;">
        <div class="pill" title="ë§¤ì¥ëª…">
          <span class="dot" aria-hidden="true"></span>
          <strong id="storeName">-</strong>
          <span>ì—ì„œ ê²°ì œ ì¤‘</span>
        </div>
      </div>

      <section class="panel" aria-label="ê²°ì œ ì •ë³´ ì…ë ¥">
        <div class="form-grid">
          <div>
            <label for="categorySelect">ê²°ì œ ì¥ì†Œ</label>
            <select id="categorySelect">
              <option value="">ê²°ì œ ì¥ì†Œ</option>
              <option value="ì¹´í˜">ì¹´í˜/ë””ì €íŠ¸</option>
              <option value="ìŒì‹ì ">ìŒì‹ì /ì‹ë‹¹</option>
              <option value="í¸ì˜ì ">í¸ì˜ì /ë§ˆíŠ¸</option>
              <option value="ëŒ€ì¤‘êµí†µ">ëŒ€ì¤‘êµí†µ</option>
              <option value="ì˜¨ë¼ì¸">ì˜¨ë¼ì¸ ì‡¼í•‘</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
          </div>

          <!-- âœ… ê²°ì œê¸ˆì•¡ ì…ë ¥ë€ ì‚­ì œ (ìš”êµ¬ì‚¬í•­ ë°˜ì˜) -->
        </div>

        <button class="btn primary" id="btnRecommend">ì¹´ë“œ ì¶”ì²œë°›ê¸°</button>
        <button class="btn ghost" id="btnReset">ë‹¤ì‹œ ì„ íƒ</button>
      </section>

      <section class="panel" aria-label="ì¶”ì²œ ê²°ê³¼">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:10px;">
          <h2 style="margin:0;">ì¶”ì²œ ì¹´ë“œ ë­í‚¹</h2>
          <span id="resultSub" style="font-size:12px; color:var(--brand); font-weight:900; white-space:nowrap;"></span>
        </div>

        <div id="results">
          <div class="muted-center">ì ë“¤ì–´ ìˆëŠ” ìˆ¨ì€ ë‚´ ì¹´ë“œ í˜œíƒì„ ê¹¨ì›Œì£¼ì„¸ìš”!.</div>
        </div>
      </section>
    </div>
  </main>

  <!-- âœ… ìŠ¤í¬ë¡¤ ìœ ë„ CTA -->
  <div class="scroll-cta" id="scrollCta" aria-label="ë‹¤ìŒ ì¹´ë“œ ë³´ê¸°">
    <div class="inner" role="button" tabindex="0">
      <div class="t" id="scrollCtaText">ìŠ¤í¬ë¡¤í•´ì„œ ë”ì¹˜í˜ì´ í™•ì¸í•´ë³´ì„¸ìš”!</div>
      <div class="chev" aria-hidden="true">âŒ„</div>
    </div>
  </div>

  <script>
    window.addEventListener('load', () => {
      setTimeout(() => {
        const s = document.getElementById('splash');
        s.classList.add('fade-out');
        setTimeout(() => s.style.display = 'none', 420);
      }, 900);
    });

    const params = new URLSearchParams(window.location.search);

    function safeDecode(value){
      try { return decodeURIComponent(value || ''); } catch(e){ return value || ''; }
    }

    function normalizeCategory(v){
      const s = (v || '').trim();
      const allowed = ["ì¹´í˜","ìŒì‹ì ","í¸ì˜ì ","ëŒ€ì¤‘êµí†µ","ì˜¨ë¼ì¸","ê¸°íƒ€"];
      if (allowed.includes(s)) return s;
      const map = { "ì¹´í˜/ë””ì €íŠ¸":"ì¹´í˜", "ì‹ë‹¹":"ìŒì‹ì ", "ë ˆìŠ¤í† ë‘":"ìŒì‹ì " };
      return map[s] || "";
    }

    const pFrom = (params.get('from') || '').trim().toLowerCase();
    const pStore = safeDecode(params.get('store') || '').trim();
    const pCategory = normalizeCategory(safeDecode(params.get('category') || '').trim());

    const categorySelect = document.getElementById('categorySelect');
    const resultsEl = document.getElementById('results');
    const resultSub = document.getElementById('resultSub');

    const storeWrap = document.getElementById('storeWrap');
    const storeName = document.getElementById('storeName');

    const btnRecommend = document.getElementById('btnRecommend');
    const btnReset = document.getElementById('btnReset');

    const scrollCta = document.getElementById('scrollCta');
    const scrollCtaText = document.getElementById('scrollCtaText');
    const mainEl = document.getElementById('main');

    let hasRecommended = false;

    if (pStore) {
      storeName.textContent = pStore;
      storeWrap.style.display = 'block';
    }

    if (pCategory) {
      categorySelect.value = pCategory;
    }

    function formatKRWNumber(n){
      const v = Number(n);
      if (!Number.isFinite(v) || v <= 0) return '-';
      return v.toLocaleString('ko-KR') + 'ì›';
    }

    // âœ… (ì¶”ì •ì¹˜) êµ­ë¯¼ 1ì¸ë‹¹ ì›” ì†ì‹¤ì•¡ ê³„ì‚°ìš© ìƒìˆ˜/í•¨ìˆ˜
    // - 2024ë…„ ì‹ ìš©ì¹´ë“œ ì´ìš©ê¸ˆì•¡(ì—°): 1,040,163 ì‹­ì–µì›
    // - ì´ì¸êµ¬: 51,810,000ëª…(ê·¼ì‚¬)
    // - í‰ê·  ë¶€ê°€ì„œë¹„ìŠ¤(í˜œíƒ) ìš”ìœ¨: 0.7%
    // - ë¯¸ì‚¬ìš©/ë¯¸ìµœì í™”ë¡œ ë†“ì¹˜ëŠ” ë¹„ìœ¨(ì¶”ì •): 50%
    const STAT_POP = 51810000;
    const STAT_CREDIT_SPEND_ANNUAL_WON = 1040163 * 1e9; // ì‹­ì–µì› â†’ ì›
    const STAT_AVG_BENEFIT_RATE = 0.007;               // 0.7%
    const STAT_MISSED_RATIO = 0.50;                    // ì¶”ì •(ë¯¸ì‚¬ìš©/ë¯¸ìµœì í™”)

    function calcAvgLossWonPerPersonMonthly(){
      const perPersonMonthlySpend = (STAT_CREDIT_SPEND_ANNUAL_WON / STAT_POP) / 12;
      const potentialBenefit = perPersonMonthlySpend * STAT_AVG_BENEFIT_RATE;
      const missed = potentialBenefit * STAT_MISSED_RATIO;
      return Math.round(missed); // 1ì› ë°˜ì˜¬ë¦¼
    }

    function wonToManwonText(won){
      const man = Number(won) / 10000;
      // 0.1ë§Œì› ë‹¨ìœ„ë¡œ ê³ ì •(ì˜ˆ: 0.6ë§Œì›)
      return (Math.round(man * 10) / 10).toFixed(1);
    }

    // âœ… ê²°ì œê¸ˆì•¡ ì…ë ¥ ì œê±° ì´í›„: ì¹´í…Œê³ ë¦¬ë³„ 1ì¸ í‰ê·  êµ¬ë§¤ì•¡(ì¶”ì •)
    function getAvgPurchaseAmount(category, store){
      const s = (store || "").toLowerCase();
      const isStarbucks = (s.includes("ìŠ¤íƒ€ë²…ìŠ¤") || s.includes("starbucks"));

      const base = {
        "ì¹´í˜": 18000,
        "ìŒì‹ì ": 25000,
        "í¸ì˜ì ": 12000,
        "ëŒ€ì¤‘êµí†µ": 2800,
        "ì˜¨ë¼ì¸": 45000,
        "ê¸°íƒ€": 20000
      };

      let amt = base[category] ?? 20000;
      if (category === "ì¹´í˜" && isStarbucks) amt = 22000;

      return amt;
    }

    function buildDutchInline(n){
      if (!Number.isFinite(n) || n <= 0) return null;

      const wrap = document.createElement('div');
      wrap.className = 'rec-card pop';
      wrap.innerHTML = `
        <div class="badge warn">ë”ì¹˜í˜ì´ Â· ë¹ ë¥¸ ê³„ì‚°</div>
        <div class="dutch-box" aria-label="ë”ì¹˜í˜ì´ ê³„ì‚°">
          <div class="dutch-head">
            <div class="dutch-title">ë”ì¹˜í˜ì´ ê³„ì‚°</div>
            <div class="dutch-total">ì´ì•¡ ${n.toLocaleString('ko-KR')}ì›</div>
          </div>
          <div class="dutch-grid"></div>
          <div class="dutch-foot">â€» 1ì¸ë‹¹ ê¸ˆì•¡ì€ ì› ë‹¨ìœ„ ë‚´ë¦¼ ê¸°ì¤€ì…ë‹ˆë‹¤.</div>
        </div>
      `;

      const grid = wrap.querySelector('.dutch-grid');
      for (let people = 2; people <= 5; people++){
        const per = Math.floor(n / people);
        const remainder = n - (per * people);

        const div = document.createElement('div');
        div.className = 'dutch-item';
        div.innerHTML = `
          <div class="n">ğŸ‘¥ ${people}ëª…</div>
          <div class="amt">${per.toLocaleString('ko-KR')}ì›</div>
          <div style="margin-top:5px; font-size:11px; font-weight:800; color:rgba(71,84,103,0.9);">
            ë‚¨ëŠ” ê¸ˆì•¡: ${remainder.toLocaleString('ko-KR')}ì›
          </div>
        `;
        grid.appendChild(div);
      }

      return wrap;
    }

    const dummyCards = [
      {
        issuer: "ì‹ í•œ",
        name: "ì‹ í•œì¹´ë“œ Mr.Life",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 420000 },
        rules: [
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  10% í• ì¸(24ì‹œê°„) Â· ì „ì›”ì‹¤ì /ì›” í• ì¸í•œë„/ê°€ë§¹ì  ì—…ì¢… ê¸°ì¤€ ì ìš©" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ì˜¨ë¼ì¸ ì‡¼í•‘ 10% í• ì¸(21:00~09:00) Â· ì „ì›”ì‹¤ì /ì›” í• ì¸í•œë„/ëŒ€ìƒëª° ê¸°ì¤€ ì ìš©" },
          { category:["ìŒì‹ì "], benefit:"ì‹ìŒë£Œ 10% í• ì¸(21:00~09:00) Â· ì „ì›”ì‹¤ì /ì›” í• ì¸í•œë„/ê°€ë§¹ì  ì—…ì¢… ê¸°ì¤€ ì ìš©" },
          { category:["ì¹´í˜"], benefit:"ì‹ìŒë£Œ 10% í• ì¸(21:00~09:00) Â· ì „ì›”ì‹¤ì /ì›” í• ì¸í•œë„/ê°€ë§¹ì  ì—…ì¢… ê¸°ì¤€ ì ìš©" }
        ],
        fallback: "ìƒí™œ/ì‹œê°„ëŒ€ í• ì¸(ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì Â·í•œë„Â·ê°€ë§¹ì  ê¸°ì¤€ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "ì‚¼ì„±",
        name: "ì‚¼ì„±ì¹´ë“œ taptap O",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 350000 },
        rules: [
          { category:["ì¹´í˜"], benefit:"ìŠ¤íƒ€ë²…ìŠ¤ 50% í• ì¸(ì›” 1ë§Œì› í•œë„, ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì /ëŒ€ìƒì  ê¸°ì¤€ ì ìš©" },
          { category:["ëŒ€ì¤‘êµí†µ"], benefit:"ëŒ€ì¤‘êµí†µÂ·íƒì‹œ 10% í• ì¸(ì›” 5ì²œì› í•œë„, ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì /ëŒ€ìƒ ê¸°ì¤€ ì ìš©" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ì‡¼í•‘ 7% í• ì¸(ì›” 5ì²œì› í•œë„, ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì /ëŒ€ìƒ ê¸°ì¤€ ì ìš©" }
        ],
        fallback: "ë¼ì´í”„ìŠ¤íƒ€ì¼ í• ì¸(ëŒ€í‘œ) Â· ì „ì›”ì‹¤ì Â·í•œë„Â·ëŒ€ìƒ ê°€ë§¹ì  ê¸°ì¤€ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”"
      },
      {
        issuer: "í˜„ëŒ€",
        name: "í˜„ëŒ€ì¹´ë“œ ZERO Edition2(í• ì¸í˜•)",
        requirements: { monthlySpendMin: 0 },
        user: { monthlySpent: 0 },
        rules: [
          { category:["ê¸°íƒ€"], benefit:"ëª¨ë“  ê°€ë§¹ì  0.7% ì²­êµ¬í• ì¸(ì¡°ê±´ ì—†ìŒ, ëŒ€í‘œ) Â· ê°€ë§¹ì /ì œì™¸ í•­ëª© ê¸°ì¤€ ì ìš©" },
          { category:["ìŒì‹ì "], benefit:"ì™¸ì‹ 1.5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì˜ì—­/ì œì™¸ í•­ëª© ê¸°ì¤€ ì ìš©" },
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  1.5% ì²­êµ¬í• ì¸(ëŒ€í‘œ) Â· ì˜ì—­/ì œì™¸ í•­ëª© ê¸°ì¤€ ì ìš©" },
          { category:["ì¹´í˜"], benefit:"ëª¨ë“  ê°€ë§¹ì  0.7% ì²­êµ¬í• ì¸(ì¡°ê±´ ì—†ìŒ, ëŒ€í‘œ) Â· ê°€ë§¹ì /ì œì™¸ í•­ëª© ê¸°ì¤€ ì ìš©" },
          { category:["ì˜¨ë¼ì¸"], benefit:"ëª¨ë“  ê°€ë§¹ì  0.7% ì²­êµ¬í• ì¸(ì¡°ê±´ ì—†ìŒ, ëŒ€í‘œ) Â· ê°€ë§¹ì /ì œì™¸ í•­ëª© ê¸°ì¤€ ì ìš©" }
        ],
        fallback: "ëª¨ë“  ê°€ë§¹ì  0.7% ì²­êµ¬í• ì¸(ì¡°ê±´ ì—†ìŒ, ëŒ€í‘œ) Â· ê°€ë§¹ì /ì œì™¸ í•­ëª© ê¸°ì¤€ ì ìš©"
      }
    ];

    function inferIssuerAffinity(store){
      const s = (store || "").toLowerCase();
      if (s.includes("ìŠ¤íƒ€ë²…ìŠ¤") || s.includes("starbucks")) return "ì‹ í•œ";
      if (s.includes("gs") || s.includes("gs25")) return "êµ­ë¯¼";
      if (s.includes("cu")) return "í˜„ëŒ€";
      return "";
    }

    function findRule(card, category){
      return card.rules.find(r => (r.category || []).includes(category)) || null;
    }

    function computePayback(card, category, amount, store){
      const n = Number(amount);
      if (!Number.isFinite(n) || n <= 0) {
        return { payback: 0, rate: 0, effectiveRate: 0, baseAmount: 0, note: "â€» í‰ê·  êµ¬ë§¤ì•¡ ì¶”ì •ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë³´ìˆ˜ì ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤." };
      }

      const req = Number(card.requirements?.monthlySpendMin || 0);
      const spent = Number(card.user?.monthlySpent || 0);
      const met = (req === 0) ? true : (spent >= req);

      const name = String(card.name || "");
      const isZero = name.includes("ZERO");

      if (!met && !isZero) {
        return { payback: 0, rate: 0, effectiveRate: 0, baseAmount: n, note: "â€» ì „ì›”ì‹¤ì  ë¯¸ì¶©ì¡±ìœ¼ë¡œ í˜œíƒì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ ë³´ìˆ˜ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤." };
      }

      const now = new Date();
      const hour = now.getHours();
      const isNight = (hour >= 21 || hour < 9);

      let rate = 0;
      let cap = Infinity;
      let eligibleBase = Infinity;
      let note = "";

      if (isZero) {
        if (category === "ìŒì‹ì " || category === "í¸ì˜ì ") rate = 0.015;
        else rate = 0.007;
        const rawZero = Math.floor(n * rate);
        const payback = Math.max(0, rawZero);
        const effectiveRate = n > 0 ? (payback / n) : 0;
        return { payback, rate, effectiveRate, baseAmount: n, note: "â€» ì¡°ê±´ ì—†ëŠ” ì²­êµ¬í• ì¸ ê¸°ì¤€(ì œì™¸ í•­ëª©/ì˜ì—­ ê¸°ì¤€ì€ ë¯¸ë°˜ì˜)ìœ¼ë¡œ ë³´ìˆ˜ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤." };
      }

      if (name.includes("Mr.Life")) {
        if (category === "í¸ì˜ì ") {
          rate = 0.10;
          eligibleBase = 10000;
          cap = 1000;
          note = "â€» ê°€ë§¹ì  ì—…ì¢…/ì›” í•œë„/íšŸìˆ˜ ê¸°ì¤€ì€ ë¯¸ë°˜ì˜ì´ë©°, ë³´ìˆ˜ì ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.";
        } else if (category === "ì˜¨ë¼ì¸" || category === "ìŒì‹ì " || category === "ì¹´í˜") {
          if (!isNight) {
            return { payback: 0, rate: 0, effectiveRate: 0, baseAmount: n, note: "â€» í•´ë‹¹ ì¹´ë“œ í˜œíƒì€ 21:00~09:00 ì‹œê°„ëŒ€ê°€ ë” ìœ ë¦¬í•œ ê²ƒìœ¼ë¡œ ë³´ìˆ˜ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤." };
          }
          rate = 0.10;
          eligibleBase = 10000;
          cap = 1000;
          note = "â€» 21:00~09:00 ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ ë³´ìˆ˜ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤(ì›” í•œë„/íšŸìˆ˜/ëŒ€ìƒ ê¸°ì¤€ì€ ë¯¸ë°˜ì˜).";
        } else {
          return { payback: 0, rate: 0, effectiveRate: 0, baseAmount: n, note: "â€» í˜„ì¬ ì„ íƒ ì—…ì¢…ì—ì„œëŠ” ëŒ€í‘œ í˜œíƒì´ ì•½í•œ ê²ƒìœ¼ë¡œ ì˜ˆì¸¡ë©ë‹ˆë‹¤." };
        }

        const base = Math.min(n, eligibleBase);
        const raw = Math.floor(base * rate);
        const payback = Math.max(0, Math.min(raw, cap));
        const effectiveRate = n > 0 ? (payback / n) : 0;
        return { payback, rate, effectiveRate, baseAmount: n, note };
      }

      if (name.includes("taptap O")) {
        if (category === "ì¹´í˜") {
          const s = (store || "");
          const lower = s.toLowerCase();
          const isStarbucks = (s.includes("ìŠ¤íƒ€ë²…ìŠ¤") || lower.includes("starbucks"));

          if (!isStarbucks) {
            return { payback: 0, rate: 0, effectiveRate: 0, baseAmount: n, note: "â€» ëŒ€ìƒì ì´ í™•ì‹¤í•˜ì§€ ì•Šì•„ ê³¼ëŒ€ì¶”ì • ë°©ì§€ë¥¼ ìœ„í•´ 0ì›ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤." };
          }

          rate = 0.50;
          cap = 10000;
          const raw = Math.floor(n * rate);
          const payback = Math.max(0, Math.min(raw, cap));
          const effectiveRate = n > 0 ? (payback / n) : 0;
          const capNote = (raw > cap) ? "â€» í•œë„ ë•Œë¬¸ì— 10,000ì›ê¹Œì§€ë§Œ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤. " : "";
          return { payback, rate, effectiveRate, baseAmount: n, note: `${capNote}â€» ìŠ¤íƒ€ë²…ìŠ¤ ê²°ì œ ê¸°ì¤€ìœ¼ë¡œ ë³´ìˆ˜ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤(ì›” ì”ì—¬í•œë„/ì œì™¸ í•­ëª©ì€ ë¯¸ë°˜ì˜).` };
        }

        if (category === "ëŒ€ì¤‘êµí†µ") {
          rate = 0.10;
          cap = 5000;
          const raw = Math.floor(n * rate);
          const payback = Math.max(0, Math.min(raw, cap));
          const effectiveRate = n > 0 ? (payback / n) : 0;
          const capNote = (raw > cap) ? "â€» í•œë„ ë•Œë¬¸ì— 5,000ì›ê¹Œì§€ë§Œ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤. " : "";
          return { payback, rate, effectiveRate, baseAmount: n, note: `${capNote}â€» ì „ì›”ì‹¤ì /ì›” í•œë„/ëŒ€ìƒ ê¸°ì¤€ì€ ë¯¸ë°˜ì˜ì´ë©°, ë³´ìˆ˜ì ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.` };
        }

        if (category === "ì˜¨ë¼ì¸") {
          rate = 0.07;
          cap = 5000;
          const raw = Math.floor(n * rate);
          const payback = Math.max(0, Math.min(raw, cap));
          const effectiveRate = n > 0 ? (payback / n) : 0;
          const capNote = (raw > cap) ? "â€» í•œë„ ë•Œë¬¸ì— 5,000ì›ê¹Œì§€ë§Œ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤. " : "";
          return { payback, rate, effectiveRate, baseAmount: n, note: `${capNote}â€» ì „ì›”ì‹¤ì /ì›” í•œë„/ëŒ€ìƒ ê¸°ì¤€ì€ ë¯¸ë°˜ì˜ì´ë©°, ë³´ìˆ˜ì ìœ¼ë¡œ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.` };
        }

        return { payback: 0, rate: 0, effectiveRate: 0, baseAmount: n, note: "â€» í˜„ì¬ ì„ íƒ ì—…ì¢…ì—ì„œëŠ” ëŒ€í‘œ í˜œíƒì´ ì•½í•œ ê²ƒìœ¼ë¡œ ì˜ˆì¸¡ë©ë‹ˆë‹¤." };
      }

      return { payback: 0, rate: 0, effectiveRate: 0, baseAmount: n, note: "â€» ëŒ€í‘œ í˜œíƒ ì ìš© ì¡°ê±´ì´ ë¶ˆí™•ì‹¤í•˜ì—¬ 0ì›ìœ¼ë¡œ ë³´ìˆ˜ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤." };
    }

    function computeScore(card, category, store){
      let score = 0;

      const rule = findRule(card, category);
      score += rule ? 55 : 15;

      const req = Number(card.requirements?.monthlySpendMin || 0);
      const spent = Number(card.user?.monthlySpent || 0);
      const met = (req === 0) ? true : (spent >= req);
      score += met ? 25 : -10;

      const affinity = inferIssuerAffinity(store);
      if (affinity && affinity === card.issuer) score += 12;

      score = Math.max(0, Math.min(100, score));
      return { score, met, rule, req, spent };
    }

    function badgeByScore(score){
      if (score >= 80) return { cls:"ok", label:"ìµœì  í˜œíƒ" };
      if (score >= 60) return { cls:"warn", label:"ì¶”ì²œ" };
      return { cls:"bad", label:"ë¹„ì¶”ì²œ" };
    }

    function buildWhyText(item, category, store){
      const parts = [];
      parts.push(item.rule ? `${category} í˜œíƒ ì¼ì¹˜` : `${category} í˜œíƒ ì•½í•¨`);
      if (item.req === 0) parts.push("ì „ì›”ì‹¤ì  ì¡°ê±´ ì—†ìŒ");
      else parts.push(item.met ? "ì „ì›”ì‹¤ì  ì¶©ì¡±" : "ì „ì›”ì‹¤ì  ë¯¸ì¶©ì¡±");

      const affinity = inferIssuerAffinity(store || "");
      if (affinity && affinity === item.card.issuer) parts.push("ë§¤ì¥-ì¹´ë“œì‚¬ ì¶”ì • ì¼ì¹˜");

      return parts.slice(0, 3).join(" Â· ");
    }

    function showIdleResults(){
      // âœ… ìš”ì²­: êµ­ë¯¼ í‰ê·  ê¸°ë°˜ 'në§Œì›' ê³„ì‚° â†’ ë¬¸êµ¬ì— ì‚½ì…
      const lossWon = calcAvgLossWonPerPersonMonthly();
      const lossManwon = wonToManwonText(lossWon);

      resultsEl.innerHTML = `<div class="muted-center"> ì¹´ë“œí˜œíƒ/í¬ì¸íŠ¸ ë¯¸ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ë§¤ì›” ì•½ 1.2ë§Œì›ì˜ ì†ì‹¤ì•¡ì´ ë°œìƒí•´ìš”!</div>`;
      resultSub.textContent = "";
      hideScrollCTA();
    }

    function showLoadingResults(){
      resultsEl.innerHTML = '<div class="muted-center">1ì´ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</div>';
      hideScrollCTA();
    }

    function hideScrollCTA(){
      scrollCta.style.display = "none";
      mainEl.classList.remove("pad-bottom");
    }

    function showScrollCTA(){
      scrollCtaText.textContent = "ìŠ¤í¬ë¡¤í•´ì„œ ë”ì¹˜í˜ì´ í™•ì¸í•´ë³´ì„¸ìš”!";
      scrollCta.style.display = "block";
      mainEl.classList.add("pad-bottom");
    }

    function scrollToNextCard(){
      const cards = Array.from(resultsEl.querySelectorAll('.rec-card'));
      if (!cards.length) return;

      const y = window.scrollY;
      const vh = window.innerHeight;
      let target = null;

      for (const el of cards){
        const top = el.getBoundingClientRect().top + window.scrollY;
        if (top > y + (vh * 0.55)) { target = el; break; }
      }

      if (!target) target = cards[cards.length - 1];

      target.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function attachScrollCTA(){
      const cards = Array.from(resultsEl.querySelectorAll('.rec-card'));
      if (cards.length <= 1) {
        hideScrollCTA();
        return;
      }
      showScrollCTA();
    }

    scrollCta.addEventListener('click', scrollToNextCard);
    scrollCta.addEventListener('keydown', (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        scrollToNextCard();
      }
    });

    function renderResults(){
      const cat = categorySelect.value;
      if (!cat) {
        showIdleResults();
        return;
      }

      const ctx = [cat];
      if (pFrom === "qr" || pCategory) ctx.push("QR ì§„ì…");
      resultSub.textContent = ctx.join(" Â· ");

      const storeForScore = (pStore || "ìŠ¤íƒ€ë²…ìŠ¤");
      const avgAmount = getAvgPurchaseAmount(cat, pStore || "");

      const ranked = dummyCards
        .map(card => ({ card, ...computeScore(card, cat, storeForScore) }))
        .sort((a,b) => b.score - a.score);

      resultsEl.innerHTML = "";

      const dutchInline = null;

      ranked.forEach((item, idx) => {
        const { card, score, met, rule, req, spent } = item;
        const badge = badgeByScore(score);

        const perfText = (req === 0)
          ? "ì „ì›”ì‹¤ì  ì¡°ê±´ ì—†ìŒ"
          : (met
              ? `ì „ì›”ì‹¤ì  ${req.toLocaleString('ko-KR')}ì› ì¶©ì¡±`
              : `ì „ì›”ì‹¤ì  ë¯¸ì¶©ì¡± (${Math.max(0, req - spent).toLocaleString('ko-KR')}ì› ë¶€ì¡±)`);

        const benefitText = rule?.benefit || card.fallback;
        const whyText = (idx === 0) ? buildWhyText(item, cat, pStore || "") : "";

        const pb = computePayback(card, cat, avgAmount, pStore || "");
        const effectivePct = Math.round((pb.effectiveRate || 0) * 1000) / 10;
        const ratePct = Math.round((pb.rate || 0) * 1000) / 10;

        const paybackHtml = `
          <div class="payback-highlight">
            <div class="payback-top">
              <div class="payback-label">AI ì˜ˆìƒ í˜ì´ë°±</div>
              <div class="payback-amt">${formatKRWNumber(pb.payback)}</div>
            </div>
            <div class="payback-foot">
              í• ì¸ìœ¨: ${effectivePct}%${(pb.rate && pb.rate !== pb.effectiveRate) ? ` (ëª…ëª© ${ratePct}%)` : ``}<br/>
              1ì¸ í‰ê·  êµ¬ë§¤ì•¡: ${formatKRWNumber(avgAmount)} Â· í‰ê·  í™˜ì‚°ì•¡: ${formatKRWNumber(pb.payback)}<br/>
              1ì¸ í‰ê·  êµ¬ë§¤ì•¡ ëŒ€ë¹„ í• ì¸ê¸ˆì•¡: ${formatKRWNumber(pb.payback)}<br/>
              ${pb.note}
            </div>
          </div>
        `;

        const div = document.createElement('div');
        div.className = `rec-card pop ${idx === 0 ? "top" : ""}`;
        div.innerHTML = `
          <div class="badge ${badge.cls}">${idx+1}ìˆœìœ„ Â· ${badge.label} (${score}ì )</div>
          <div class="rec-title">${card.name}</div>
          <div class="rec-meta">${card.issuer} Â· ${perfText}</div>
          ${idx === 0 ? `<div class="why"><span class="chip">WHY?</span><span class="why-text">${whyText}</span></div>` : ``}
          <div class="benefit-highlight">ğŸ’° ${benefitText}</div>
          ${paybackHtml}
        `;
        resultsEl.appendChild(div);

        if (idx === 1 && dutchInline) {
          resultsEl.appendChild(dutchInline);
        }
      });

      attachScrollCTA();
    }

    function refreshCTA(){
      const hasCat = !!(categorySelect.value || "").trim();
      const isLoading = btnRecommend.classList.contains("loading");
      btnRecommend.disabled = !hasCat || isLoading;
    }

    function setCTALoading(on){
      if (on){
        btnRecommend.classList.add("loading");
        btnRecommend.dataset.prevText = btnRecommend.textContent;
        btnRecommend.textContent = "í˜œíƒ ê³„ì‚° ì¤‘â€¦";
        btnRecommend.disabled = true;
      } else {
        btnRecommend.classList.remove("loading");
        btnRecommend.textContent = btnRecommend.dataset.prevText || "ì¹´ë“œ ì¶”ì²œë°›ê¸°";
        refreshCTA();
      }
    }

    btnRecommend.addEventListener('click', () => {
      refreshCTA();
      if (btnRecommend.disabled) return;

      hasRecommended = true;

      setCTALoading(true);
      showLoadingResults();
      setTimeout(() => {
        renderResults();
        setCTALoading(false);
      }, 1000);
    });

    btnReset.addEventListener('click', () => {
      categorySelect.value = pCategory || "";
      hasRecommended = false;

      showIdleResults();
      refreshCTA();
    });

    categorySelect.addEventListener('change', () => {
      refreshCTA();
      if (!hasRecommended) showIdleResults();
    });

    refreshCTA();
    showIdleResults();
  </script>
</body>
</html>

