<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¤ì¤: ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</title>
  <meta name="description" content="ê²°ì œ ì§ì „, ê°€ì¥ ìœ ë¦¬í•œ ê²°ì œìˆ˜ë‹¨ì„ ì¶”ì²œí•˜ëŠ” ì¤ì¤(JUPJUP)" />

  <link rel="icon" href="/logo1.png?v=2" type="image/png" />
  <link rel="apple-touch-icon" href="/logo1.png?v=2" />

  <style>
    :root {
      --bg: #f8f9fc;
      --card: #ffffff;
      --text: #101828;
      --muted: #475467;
      --line: #eaecf0;

      --brand: #FF6B00;
      --brand-weak: #fff1e6;
      --brand-dark: #E66000;

      --shadow: 0 12px 16px -4px rgba(16, 24, 40, 0.08);
      --radius: 20px;

      --ok: #027a48;
      --ok-bg: #ecfdf3;
      --warn: #b44d12;
      --warn-bg: #fffaeb;
      --bad: #b42318;
      --bad-bg: #fef3f2;

      --splash-top: #FF7A1A;
      --splash-bottom: #FFB46A;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    /* ===== Splash ===== */
    .splash {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(900px 520px at 50% 28%, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, var(--splash-top) 0%, var(--splash-bottom) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 400ms ease;
    }
    .splash.fade-out { opacity: 0; pointer-events: none; }

    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      text-align: center;
      padding: 24px 18px;
    }
    .splash img {
      width: 150px;
      height: 150px;
      object-fit: contain;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.14));
    }

    .splash-title {
      font-weight: 900;
      font-size: 35px;
      color: rgba(255,255,255,0.98);
      letter-spacing: -0.04em;
      line-height: 1.05;
      text-shadow: 0 10px 20px rgba(0,0,0,0.06);
    }
    .splash-subtitle {
      font-weight: 900;
      font-size: 21px;
      color: rgba(255,255,255,0.92);
      letter-spacing: -0.02em;
    }

    /* ===== Header ===== */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--line);
    }
    .header-inner {
      max-width: 600px;
      margin: 0 auto;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 28px;
    }
    .brand img {
      width: 26px !important;
      height: 26px !important;
      display: block !important;
      object-fit: contain !important;
    }
    .brand .name {
      font-weight: 900;
      font-size: 16px;
      color: var(--brand);
      letter-spacing: -0.02em;
      white-space: nowrap;
    }
    .header-right {
      font-size: 12px;
      color: var(--muted);
      font-weight: 800;
      white-space: nowrap;
    }

    main {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px 16px;
    }
    .stack { display: flex; flex-direction: column; gap: 16px; }

    /* ===== UI Elements ===== */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      background: white;
      border: 1px solid var(--line);
      font-size: 14px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
      max-width: 100%;
    }
    .pill .dot { width: 8px; height: 8px; background: var(--brand); border-radius: 50%; }
    .pill strong { white-space: nowrap; }
    .pill span {
      color: var(--muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .panel h2 {
      margin: 0 0 16px;
      font-size: 15px;
      font-weight: 900;
      color: var(--muted);
      letter-spacing: -0.01em;
    }

    .form-grid { display: flex; flex-direction: column; gap: 16px; }
    label {
      display: block;
      font-size: 13px;
      font-weight: 800;
      color: var(--muted);
      margin-bottom: 6px;
    }
    select, input {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fff;
      font-size: 15px;
      outline: none;
      transition: all 0.2s;
    }
    select:focus, input:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--brand-weak); }

    .btn {
      width: 100%;
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-weight: 900;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
      position: relative;
    }
    .btn.primary { background: var(--brand); color: white; margin-top: 8px; }
    .btn.primary:active { background: var(--brand-dark); transform: scale(0.98); }
    .btn.ghost { background: transparent; color: var(--muted); padding: 10px 8px; font-size: 14px; font-weight: 900; }

    .btn:disabled { opacity: 0.65; cursor: not-allowed; }
    .btn.primary.loading::after{
      content:"";
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.55);
      border-top-color: rgba(255,255,255,1);
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      animation: jupupSpin 0.9s linear infinite;
    }
    @keyframes jupupSpin { to { transform: translateY(-50%) rotate(360deg); } }

    .rec-card {
      position: relative;
      border-radius: var(--radius);
      background: white;
      border: 1px solid var(--line);
      padding: 20px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    .rec-card.top {
      border: 2px solid var(--brand);
      background: linear-gradient(180deg, #fff 0%, #fff9f5 100%);
      box-shadow: 0 10px 20px rgba(255,107,0,0.10);
      overflow: visible;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 900;
      margin-bottom: 12px;
    }
    .badge.ok { background: var(--ok-bg); color: var(--ok); }
    .badge.warn { background: var(--warn-bg); color: var(--warn); }
    .badge.bad { background: var(--bad-bg); color: var(--bad); }

    .rec-title { font-size: 18px; font-weight: 900; margin-bottom: 6px; letter-spacing: -0.02em; }
    .rec-meta { font-size: 13px; color: var(--muted); margin-bottom: 14px; font-weight: 800; }

    /* 1ë“± ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
    .rec-card.top::before {
      content: "";
      position: absolute;
      top: 0; left: -150%;
      width: 100%; height: 100%;
      background: linear-gradient(
        90deg,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.7) 50%,
        rgba(255,255,255,0) 100%
      );
      transform: skewX(-25deg);
      animation: glitter 3.5s infinite;
      z-index: 1;
    }
    @keyframes glitter {
      0% { left: -150%; }
      30% { left: 150%; }
      100% { left: 150%; }
    }

    .rec-card.top > *{
      position: relative;
      z-index: 2;
    }

    .why {
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      margin: 0 0 10px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
      line-height: 1.35;
    }
    .why .chip {
      flex: 0 0 auto;
      font-size: 11px;
      font-weight: 900;
      color: var(--brand-dark);
      background: rgba(255,107,0,0.10);
      border: 1px solid rgba(255,107,0,0.18);
      padding: 3px 8px;
      border-radius: 999px;
      margin-top: 1px;
    }

    .benefit-highlight {
      background: var(--brand-weak);
      color: var(--brand-dark);
      padding: 12px 12px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255, 107, 0, 0.18);
    }

    .muted-center {
      text-align: center;
      padding: 40px 0;
      color: #98a2b3;
      font-size: 14px;
      font-weight: 900;
    }

    .pop { animation: popIn 240ms ease both; }
    @keyframes popIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* âœ… ë”ì¹˜í˜ì´ UI */
    .dutch-box{
      margin-bottom: 16px;
      border-radius: 16px;
      border: 1px solid rgba(255, 107, 0, 0.18);
      background: var(--brand-weak);
      padding: 14px;
    }
    .dutch-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom: 10px;
    }
    .dutch-title{
      font-size: 13px;
      font-weight: 900;
      color: var(--brand-dark);
      letter-spacing: -0.01em;
    }
    .dutch-total{
      font-size: 12px;
      font-weight: 900;
      color: rgba(230,96,0,0.92);
      white-space: nowrap;
    }
    .dutch-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .dutch-item{
      background: rgba(255,255,255,0.80);
      border: 1px solid rgba(255,255,255,0.92);
      border-radius: 14px;
      padding: 12px;
    }
    .dutch-item .n{
      font-size: 12px;
      font-weight: 900;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .dutch-item .amt{
      font-size: 16px;
      font-weight: 900;
      color: var(--text);
      letter-spacing: -0.02em;
    }
  </style>
</head>

<body>
  <div class="splash" id="splash" aria-hidden="true">
    <div class="splash-content">
      <img src="/logo1.png" alt="ì¤ì¤ ìŠ¤í”Œë˜ì‹œ ë¡œê³ " />
      <div class="splash-title">ì¤ì¤:</div>
      <div class="splash-subtitle">ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</div>
    </div>
  </div>

  <header>
    <div class="header-inner">
      <div class="brand" aria-label="ì¤ì¤ í—¤ë”">
        <img src="/logo1.png?v=2" alt="ì¤ì¤ ë¡œê³ " />
        <div class="name">ì¤ì¤: ê²°ì œì¹´ë“œ ì¶”ì²œ ì„œë¹„ìŠ¤</div>
      </div>
      <div class="header-right"></div>
    </div>
  </header>

  <main>
    <div class="stack">
      <div id="storeWrap" style="display:none;">
        <div class="pill" title="ë§¤ì¥ëª…">
          <span class="dot" aria-hidden="true"></span>
          <strong id="storeName">-</strong>
          <span>ì—ì„œ ê²°ì œ ì¤‘</span>
        </div>
      </div>

      <section class="panel" aria-label="ê²°ì œ ì •ë³´ ì…ë ¥">
        <div class="form-grid">
          <div>
            <label for="categorySelect">ê²°ì œ ì¥ì†Œ</label>
            <select id="categorySelect">
              <option value="">ê²°ì œ ì¥ì†Œ</option>
              <option value="ì¹´í˜">ì¹´í˜/ë””ì €íŠ¸</option>
              <option value="ìŒì‹ì ">ìŒì‹ì /ì‹ë‹¹</option>
              <option value="í¸ì˜ì ">í¸ì˜ì /ë§ˆíŠ¸</option>
              <option value="ëŒ€ì¤‘êµí†µ">ëŒ€ì¤‘êµí†µ</option>
              <option value="ì˜¨ë¼ì¸">ì˜¨ë¼ì¸ ì‡¼í•‘</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
          </div>

          <div>
            <label for="amountInput">ê²°ì œ(ì˜ˆìƒ) ê¸ˆì•¡</label>
            <input id="amountInput" type="text" inputmode="numeric" placeholder="ê²°ì œê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" />
          </div>
        </div>

        <div id="inlineDutchWrap" style="display:none;">
          </div>

        <button class="btn primary" id="btnRecommend">ì¹´ë“œ ì¶”ì²œë°›ê¸°</button>
        <button class="btn ghost" id="btnReset">ë‹¤ì‹œ ì„ íƒ</button>
      </section>

      <section class="panel" aria-label="ì¶”ì²œ ê²°ê³¼">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:10px;">
          <h2 style="margin:0;">ì¶”ì²œ ì¹´ë“œ ë­í‚¹</h2>
          <span id="resultSub" style="font-size:12px; color:var(--brand); font-weight:900; white-space:nowrap;"></span>
        </div>

        <div id="results">
          <div class="muted-center">ì—…ì¢…ì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì‹­ì‹œì˜¤.</div>
        </div>
      </section>
    </div>
  </main>

  <script>
    window.addEventListener('load', () => {
      setTimeout(() => {
        const s = document.getElementById('splash');
        s.classList.add('fade-out');
        setTimeout(() => s.style.display = 'none', 420);
      }, 900);
    });

    const params = new URLSearchParams(window.location.search);

    function safeDecode(value){
      try { return decodeURIComponent(value || ''); } catch(e){ return value || ''; }
    }

    function normalizeCategory(v){
      const s = (v || '').trim();
      const allowed = ["ì¹´í˜","ìŒì‹ì ","í¸ì˜ì ","ëŒ€ì¤‘êµí†µ","ì˜¨ë¼ì¸","ê¸°íƒ€"];
      if (allowed.includes(s)) return s;
      return "";
    }

    function digitsOnly(v){
      return String(v || '').replace(/[^0-9]/g, '');
    }

    function formatKRW(v){
      const n = Number(digitsOnly(v));
      if (!Number.isFinite(n) || n <= 0) return '';
      return n.toLocaleString('ko-KR') + 'ì›';
    }

    const pStore = safeDecode(params.get('store') || '').trim();
    const pCategory = normalizeCategory(safeDecode(params.get('category') || '').trim());

    const categorySelect = document.getElementById('categorySelect');
    const amountInput = document.getElementById('amountInput');
    const resultsEl = document.getElementById('results');
    const resultSub = document.getElementById('resultSub');
    const inlineDutchWrap = document.getElementById('inlineDutchWrap');

    const storeWrap = document.getElementById('storeWrap');
    const storeName = document.getElementById('storeName');
    const btnRecommend = document.getElementById('btnRecommend');
    const btnReset = document.getElementById('btnReset');

    let hasRecommended = false;

    if (pStore) {
      storeName.textContent = pStore;
      storeWrap.style.display = 'block';
    }

    if (pCategory) {
      categorySelect.value = pCategory;
    }

    function getDutchHTML(n) {
      if (!n || n <= 0) return '';
      let grid = '';
      for (let p = 2; p <= 5; p++) {
        grid += `
          <div class="dutch-item">
            <div class="n">ğŸ‘¥ ${p}ëª…</div>
            <div class="amt">${Math.floor(n / p).toLocaleString()}ì›</div>
          </div>`;
      }
      return `
        <div class="dutch-box pop" style="margin-top:12px;">
          <div class="dutch-head">
            <div class="dutch-title">ë”ì¹˜í˜ì´ ê³„ì‚°</div>
            <div class="dutch-total">ì´ì•¡ ${n.toLocaleString()}ì›</div>
          </div>
          <div class="dutch-grid">${grid}</div>
        </div>`;
    }

    amountInput.addEventListener('input', () => {
      amountInput.value = digitsOnly(amountInput.value);
      const n = Number(amountInput.value);
      inlineDutchWrap.innerHTML = getDutchHTML(n);
      inlineDutchWrap.style.display = n > 0 ? 'block' : 'none';
    });

    const dummyCards = [
      {
        issuer: "ì‹ í•œ",
        name: "ì‹ í•œ Deep Dream",
        requirements: { monthlySpendMin: 300000 },
        user: { monthlySpent: 420000 },
        rules: [
          { category:["ì¹´í˜"], benefit:"ì¹´í˜ 10% ì ë¦½ (ì›” 5ì²œì›)" },
          { category:["ìŒì‹ì "], benefit:"ìŒì‹ì  5% ì ë¦½ (ì›” 7ì²œì›)" }
        ],
        fallback: "ê¸°ë³¸ 0.7% ì ë¦½"
      },
      {
        issuer: "êµ­ë¯¼",
        name: "KB í•´í”¼í¬ì¸íŠ¸",
        requirements: { monthlySpendMin: 400000 },
        user: { monthlySpent: 260000 },
        rules: [
          { category:["í¸ì˜ì "], benefit:"í¸ì˜ì  8% í• ì¸" },
          { category:["ì¹´í˜"], benefit:"ì¹´í˜ 7% í• ì¸" }
        ],
        fallback: "ê¸°ë³¸ í˜œíƒ ì—†ìŒ"
      },
      {
        issuer: "í˜„ëŒ€",
        name: "í˜„ëŒ€ ZERO",
        requirements: { monthlySpendMin: 0 },
        user: { monthlySpent: 0 },
        rules: [
          { category:["ì˜¨ë¼ì¸"], benefit:"ì˜¨ë¼ì¸ 2% í• ì¸" }
        ],
        fallback: "ì „ê°€ë§¹ì  1% í• ì¸"
      }
    ];

    function computeScore(card, category){
      let score = 0;
      const rule = card.rules.find(r => r.category.includes(category));
      score += rule ? 55 : 15;
      const req = card.requirements.monthlySpendMin;
      const met = req === 0 || card.user.monthlySpent >= req;
      score += met ? 25 : -10;
      return { score: Math.max(0, Math.min(100, score)), met, rule, req, spent: card.user.monthlySpent };
    }

    function renderResults(){
      const cat = categorySelect.value;
      if (!cat) return;

      const amt = Number(amountInput.value);
      resultSub.textContent = cat + (amt > 0 ? ` Â· ${amt.toLocaleString()}ì›` : '');

      const ranked = dummyCards
        .map(card => ({ card, ...computeScore(card, cat) }))
        .sort((a,b) => b.score - a.score);

      resultsEl.innerHTML = "";

      ranked.forEach((item, idx) => {
        const { card, score, met, rule, req, spent } = item;
        const badge = score >= 80 ? {cls:"ok", label:"ìµœì "} : (score >= 60 ? {cls:"warn", label:"ì¶”ì²œ"} : {cls:"bad", label:"ë¹„ì¶”ì²œ"});
        
        const cardDiv = document.createElement('div');
        cardDiv.className = `rec-card pop ${idx === 0 ? "top" : ""}`;
        cardDiv.innerHTML = `
          <div class="badge ${badge.cls}">${idx+1}ìˆœìœ„ Â· ${badge.label} (${score}ì )</div>
          <div class="rec-title">${card.name}</div>
          <div class="rec-meta">${card.issuer} Â· ${req === 0 ? "ì‹¤ì  ì¡°ê±´ ì—†ìŒ" : (met ? "ì‹¤ì  ì¶©ì¡±" : "ì‹¤ì  ë¯¸ì¶©ì¡±")}</div>
          ${idx === 0 ? `<div class="why"><span class="chip">ì¶”ì²œ ì´ìœ </span><span>ì—…ì¢… í˜œíƒê³¼ ì‹¤ì  ì¶©ì¡± ì—¬ë¶€ê°€ ê°€ì¥ ìš°ìˆ˜í•©ë‹ˆë‹¤.</span></div>` : ""}
          <div class="benefit-highlight">ğŸ’° ${rule?.benefit || card.fallback}</div>
        `;
        resultsEl.appendChild(cardDiv);

        // âœ… ìš”êµ¬ì‚¬í•­: 2ë“±(idx 1)ê³¼ 3ë“±(idx 2) ì‚¬ì´ì— ë”ì¹˜í˜ì´ ë°°ì¹˜
        if (idx === 1 && amt > 0) {
          const dutchDiv = document.createElement('div');
          dutchDiv.innerHTML = getDutchHTML(amt);
          resultsEl.appendChild(dutchDiv.firstElementChild);
        }
      });
    }

    btnRecommend.addEventListener('click', () => {
      if (!categorySelect.value) return;
      hasRecommended = true;
      btnRecommend.classList.add("loading");
      btnRecommend.disabled = true;
      resultsEl.innerHTML = '<div class="muted-center">1ì´ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</div>';
      
      setTimeout(() => {
        renderResults();
        btnRecommend.classList.remove("loading");
        btnRecommend.disabled = false;
      }, 1000);
    });

    btnReset.addEventListener('click', () => {
      categorySelect.value = pCategory || "";
      amountInput.value = "";
      inlineDutchWrap.style.display = 'none';
      resultsEl.innerHTML = '<div class="muted-center">ì—…ì¢…ì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì‹­ì‹œì˜¤.</div>';
      resultSub.textContent = "";
      hasRecommended = false;
    });

    categorySelect.addEventListener('change', () => {
      btnRecommend.disabled = !categorySelect.value;
    });
    
    btnRecommend.disabled = !categorySelect.value;
  </script>
</body>
</html>
